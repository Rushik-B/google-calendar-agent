{"ast":null,"code":"var _jsxFileName = \"/Users/Rushik/Documents/Projects/caledar-example/Calendar-app-latest-working/src/App.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useCallback, memo, useMemo, Suspense, lazy, useRef } from 'react';\nimport axios from 'axios';\nimport './App.css';\n\n// Import our Chat UI components instead of the old NewUI\nimport { ChatHeader, ChatContainer, ChatMessages, ChatMessage, ChatInput, SettingsButton, CalendarSettings, WelcomeMessage, CalendarSelectionComponent, RecommendationBar } from './ChatUI';\nimport FullCalendar from '@fullcalendar/react';\nimport dayGridPlugin from '@fullcalendar/daygrid';\nimport timeGridPlugin from '@fullcalendar/timegrid';\nimport interactionPlugin from '@fullcalendar/interaction';\n\n// SVG Path Icons for recommendation buttons\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ICONS = {\n  SCHEDULE: \"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\",\n  FREE_TIME: \"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\",\n  MEETINGS: \"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\",\n  BREAK: \"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\",\n  ASSIGNMENT: \"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\",\n  REMINDER: \"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9\"\n};\n\n// Colors for suggestion pills\nconst COLORS = {\n  BLUE: 'rgba(99, 179, 237, 0.2)',\n  // Vibrant blue\n  GREEN: 'rgba(72, 187, 120, 0.2)',\n  // Fresh green\n  ORANGE: 'rgba(246, 173, 85, 0.2)',\n  // Warm orange\n  PURPLE: 'rgba(159, 122, 234, 0.2)',\n  // Rich purple\n  RED: 'rgba(245, 101, 101, 0.2)' // Bright red\n};\n\n// Popular command suggestions\nconst DEFAULT_SUGGESTIONS = [{\n  text: \"Schedule a meeting tomorrow at 2pm\",\n  color: COLORS.BLUE,\n  icon: ICONS.SCHEDULE\n}, {\n  text: \"Find me free time this week\",\n  color: COLORS.GREEN,\n  icon: ICONS.FREE_TIME\n}, {\n  text: \"What meetings do I have today?\",\n  color: COLORS.PURPLE,\n  icon: ICONS.MEETINGS\n}, {\n  text: \"Schedule a 30-minute break\",\n  color: COLORS.ORANGE,\n  icon: ICONS.BREAK\n}, {\n  text: \"Find time to work on my assignment\",\n  color: COLORS.RED,\n  icon: ICONS.ASSIGNMENT\n}];\n\n// Define the script at global level to ensure the functions are globally accessible\nconst setupGlobalFunctions = () => {\n  if (typeof window !== 'undefined') {\n    // Create a custom event for scheduling breaks\n    window.scheduleBreak = (startTime, endTime) => {\n      console.log(\"scheduleBreak called with:\", startTime, endTime);\n      // Dispatch a custom event that the React component can listen for\n      window.dispatchEvent(new CustomEvent('scheduleCalendarItem', {\n        detail: {\n          type: 'break',\n          startTime,\n          endTime\n        }\n      }));\n    };\n\n    // Create a custom event for scheduling tasks  \n    window.scheduleTask = (startTime, endTime) => {\n      console.log(\"scheduleTask called with:\", startTime, endTime);\n      window.dispatchEvent(new CustomEvent('scheduleCalendarItem', {\n        detail: {\n          type: 'task',\n          startTime,\n          endTime\n        }\n      }));\n    };\n\n    // Log to verify functions are attached\n    console.log(\"Global scheduling functions attached:\", typeof window.scheduleBreak === 'function', typeof window.scheduleTask === 'function');\n  }\n};\n\n// Memoize the renderEventContent function to avoid recreating it on each render\nconst renderEventContent = eventInfo => {\n  var _eventInfo$event$exte, _eventInfo$event$exte2, _eventInfo$event$exte3, _eventInfo$event$exte4;\n  // Determine if this is a suggested slot or existing event\n  const isSuggested = ((_eventInfo$event$exte = eventInfo.event.extendedProps) === null || _eventInfo$event$exte === void 0 ? void 0 : _eventInfo$event$exte.suggestedSlot) === true;\n  const isExisting = ((_eventInfo$event$exte2 = eventInfo.event.extendedProps) === null || _eventInfo$event$exte2 === void 0 ? void 0 : _eventInfo$event$exte2.existingEvent) === true;\n\n  // Format the time more cleanly\n  let timeText = eventInfo.timeText || '';\n  if (timeText.includes('-')) {\n    // Simplify time range display\n    const times = timeText.split('-');\n    timeText = times[0].trim() + ' - ' + times[1].trim();\n  }\n\n  // Get the calendar name if available\n  let calendarName = '';\n  if (isExisting && (_eventInfo$event$exte3 = eventInfo.event.extendedProps) !== null && _eventInfo$event$exte3 !== void 0 && _eventInfo$event$exte3.calendarName) {\n    calendarName = `(${eventInfo.event.extendedProps.calendarName})`;\n  }\n\n  // Get the event title with fallback options\n  const title = eventInfo.event.title || ((_eventInfo$event$exte4 = eventInfo.event.extendedProps) === null || _eventInfo$event$exte4 === void 0 ? void 0 : _eventInfo$event$exte4.summary) || (isSuggested ? 'Suggested Time' : 'Event');\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `event-content ${isSuggested ? 'suggested-event' : 'existing-event'}`,\n    children: [/*#__PURE__*/_jsxDEV(\"b\", {\n      children: timeText\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"i\", {\n      children: [title, \" \", calendarName]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 106,\n    columnNumber: 5\n  }, this);\n};\n\n// Define the Calendar component outside of the main component\nconst CalendarComponent = /*#__PURE__*/memo(_c = ({\n  events,\n  handleEventClick,\n  handleDatesSet,\n  loading,\n  renderEventContent\n}) => {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `calendar-container ${loading ? 'loading' : ''}`,\n    children: /*#__PURE__*/_jsxDEV(FullCalendar, {\n      plugins: [dayGridPlugin, timeGridPlugin, interactionPlugin],\n      initialView: \"timeGridWeek\",\n      headerToolbar: {\n        left: 'prev,next today',\n        center: 'title',\n        right: 'dayGridMonth,timeGridWeek,timeGridDay'\n      },\n      events: events,\n      eventClick: handleEventClick,\n      eventContent: renderEventContent,\n      height: \"800px\",\n      nowIndicator: true,\n      datesSet: handleDatesSet,\n      slotMinTime: \"07:00:00\",\n      slotMaxTime: \"23:00:00\",\n      eventTimeFormat: {\n        hour: 'numeric',\n        minute: '2-digit',\n        meridiem: 'short'\n      },\n      slotLabelFormat: {\n        hour: 'numeric',\n        minute: '2-digit',\n        hour12: true\n      },\n      allDaySlot: false,\n      eventDisplay: \"block\",\n      eventBackgroundColor: \"#4285f4\",\n      eventBorderColor: \"#3b78e7\",\n      eventTextColor: \"#ffffff\",\n      displayEventTime: true,\n      displayEventEnd: true,\n      forceEventDuration: true,\n      eventMinHeight: 30,\n      lazyFetching: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 122,\n    columnNumber: 5\n  }, this);\n});\n_c2 = CalendarComponent;\nCalendarComponent.displayName = 'CalendarComponent';\n\n// Note: We're using CalendarSelectionComponent from ChatUI.jsx\n\nfunction NaturalLanguageForm() {\n  _s();\n  const [text, setText] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [message, setMessage] = useState(\"\");\n  const [error, setError] = useState(\"\");\n  // eslint-disable-next-line no-unused-vars\n  const [availableSlots, setAvailableSlots] = useState([]);\n  const [calendarEvents, setCalendarEvents] = useState([]);\n  const [existingEvents, setExistingEvents] = useState([]);\n  const [showCalendar, setShowCalendar] = useState(false);\n  const [eventDetails, setEventDetails] = useState({});\n  const [selectedSlots, setSelectedSlots] = useState([]);\n  // Add cache for events data\n  const [eventsCache, setEventsCache] = useState({});\n  const [fetchingEvents, setFetchingEvents] = useState(false);\n\n  // Chat-specific state\n  const [chatMessages, setChatMessages] = useState([]);\n  const [showSettings, setShowSettings] = useState(false);\n\n  // Recommendation system state\n  const [suggestions, setSuggestions] = useState([]);\n  const [showRecommendations, setShowRecommendations] = useState(false);\n\n  // Call the setup function on load\n  useEffect(() => {\n    setupGlobalFunctions();\n    // Add welcome message\n    setChatMessages([{\n      sender: 'bot',\n      type: 'welcome'\n    }]);\n\n    // Load saved popular commands from localStorage\n    loadPopularCommands();\n  }, []);\n  const [calendars, setCalendars] = useState([]);\n  const [selectedCalendars, setSelectedCalendars] = useState([]);\n  const [dateRange, setDateRange] = useState({\n    start: new Date(),\n    end: new Date(new Date().setDate(new Date().getDate() + 7))\n  });\n\n  // Helper function to format date to YYYY-MM-DD\n  const formatDate = date => {\n    const d = new Date(date);\n    let month = '' + (d.getMonth() + 1);\n    let day = '' + d.getDate();\n    const year = d.getFullYear();\n    if (month.length < 2) month = '0' + month;\n    if (day.length < 2) day = '0' + day;\n    return [year, month, day].join('-');\n  };\n\n  // Helper function to get color for a specific calendar\n  const getCalendarColor = (calendarId, darker = false) => {\n    // Find the calendar in our list\n    const calendar = calendars.find(cal => cal.id === calendarId);\n    if (calendar && calendar.backgroundColor) {\n      // Enhance color vibrancy by ensuring full opacity\n      let color = calendar.backgroundColor;\n\n      // If it's an RGBA color, convert to fully opaque\n      if (color.startsWith('rgba')) {\n        const rgbaPattern = /rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*[\\d.]+\\s*\\)/;\n        const match = color.match(rgbaPattern);\n        if (match) {\n          color = `rgb(${match[1]}, ${match[2]}, ${match[3]})`;\n        }\n      }\n      if (darker) {\n        // Create a slightly darker version for the border\n        return darkenColor(color, 0.2);\n      }\n      return color;\n    }\n    // Default color if calendar not found - using a more vibrant blue\n    return darker ? '#1565C0' : '#1E88E5';\n  };\n\n  // Helper function to darken a color\n  const darkenColor = (color, amount) => {\n    try {\n      // Handle RGB format\n      if (color.startsWith('rgb')) {\n        const rgbPattern = /rgb\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)/;\n        const match = color.match(rgbPattern);\n        if (match) {\n          let r = parseInt(match[1], 10);\n          let g = parseInt(match[2], 10);\n          let b = parseInt(match[3], 10);\n          r = Math.max(0, Math.floor(r * (1 - amount)));\n          g = Math.max(0, Math.floor(g * (1 - amount)));\n          b = Math.max(0, Math.floor(b * (1 - amount)));\n          return `rgb(${r}, ${g}, ${b})`;\n        }\n      }\n\n      // Remove the hash if it exists for hex colors\n      color = color.replace('#', '');\n\n      // Parse the color\n      let r = parseInt(color.substring(0, 2), 16);\n      let g = parseInt(color.substring(2, 4), 16);\n      let b = parseInt(color.substring(4, 6), 16);\n\n      // Darken the color\n      r = Math.max(0, Math.floor(r * (1 - amount)));\n      g = Math.max(0, Math.floor(g * (1 - amount)));\n      b = Math.max(0, Math.floor(b * (1 - amount)));\n\n      // Convert back to hex\n      return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;\n    } catch (e) {\n      console.error('Error darkening color:', e);\n      return color; // Return original color if there's an error\n    }\n  };\n\n  // Define fetchExistingEvents before it's used in the event listener\n  const fetchExistingEvents = useCallback(async (forceRefresh = false) => {\n    // Prevent multiple simultaneous requests\n    if (fetchingEvents) return;\n    try {\n      setFetchingEvents(true);\n      const startDate = formatDate(dateRange.start);\n      const endDate = formatDate(dateRange.end);\n\n      // Skip logging in production\n      if (process.env.NODE_ENV !== 'production') {\n        console.log(\"Fetching events from:\", startDate, \"to\", endDate);\n      }\n\n      // Create the calendar IDs parameter\n      const calendarIds = selectedCalendars.map(cal => cal.id).join(',');\n\n      // Create a cache key based on date range and selected calendars\n      const cacheKey = `${startDate}_${endDate}_${calendarIds}`;\n\n      // Check if we have cached data and not forcing refresh\n      if (!forceRefresh && eventsCache[cacheKey] && eventsCache[cacheKey].expiry > Date.now()) {\n        setExistingEvents(eventsCache[cacheKey].data);\n        setFetchingEvents(false);\n        return;\n      }\n\n      // Add retry logic\n      let retries = 0;\n      const maxRetries = 3;\n      let response;\n      while (retries < maxRetries) {\n        try {\n          response = await axios.get(`http://127.0.0.1:5000/api/get-events?start=${startDate}&end=${endDate}&calendars=${calendarIds}`);\n          break; // Success, exit retry loop\n        } catch (err) {\n          const currentRetry = retries; // Capture current value to avoid the loop reference issue\n          retries++;\n          if (currentRetry === maxRetries - 1) throw err;\n          // Wait before retrying (exponential backoff)\n          await new Promise(resolve => setTimeout(resolve, 1000 * Math.pow(2, currentRetry + 1)));\n        }\n      }\n      if (response.data.success) {\n        // Check if there are any events in the response\n        let events = response.data.events || [];\n\n        // If no events are returned and we're in development mode, add some mock events for testing\n        if (events.length === 0 && process.env.NODE_ENV === 'development') {\n          console.log(\"No events returned from API, adding mock events for testing\");\n          // Create a few mock events for the current week\n          const now = new Date();\n          const tomorrow = new Date(now);\n          tomorrow.setDate(tomorrow.getDate() + 1);\n          events = [{\n            id: 'mock-1',\n            title: 'Team Meeting',\n            start: new Date(now.getFullYear(), now.getMonth(), now.getDate(), 10, 0).toISOString(),\n            end: new Date(now.getFullYear(), now.getMonth(), now.getDate(), 11, 0).toISOString(),\n            calendarId: 'primary',\n            calendarName: 'Primary Calendar'\n          }, {\n            id: 'mock-2',\n            title: 'Lunch Break',\n            start: new Date(now.getFullYear(), now.getMonth(), now.getDate(), 12, 0).toISOString(),\n            end: new Date(now.getFullYear(), now.getMonth(), now.getDate(), 13, 0).toISOString(),\n            calendarId: 'primary',\n            calendarName: 'Primary Calendar'\n          }, {\n            id: 'mock-3',\n            title: 'Project Review',\n            start: new Date(tomorrow.getFullYear(), tomorrow.getMonth(), tomorrow.getDate(), 14, 0).toISOString(),\n            end: new Date(tomorrow.getFullYear(), tomorrow.getMonth(), tomorrow.getDate(), 15, 30).toISOString(),\n            calendarId: 'work',\n            calendarName: 'Work Calendar'\n          }];\n        }\n        if (events.length > 0) {\n          // Process all events at once with minimal logging\n          const eventsWithMetadata = events.map(event => ({\n            ...event,\n            title: event.title || event.summary || \"Untitled Event\",\n            existingEvent: true,\n            backgroundColor: event.backgroundColor || getCalendarColor(event.calendarId),\n            borderColor: event.borderColor || getCalendarColor(event.calendarId, true),\n            textColor: event.textColor || '#ffffff',\n            classNames: ['calendar-event'] // Add a class for additional styling\n          }));\n\n          // Update the cache with a 5-minute expiration\n          setEventsCache(prev => ({\n            ...prev,\n            [cacheKey]: {\n              data: eventsWithMetadata,\n              expiry: Date.now() + 5 * 60 * 1000 // 5 minutes\n            }\n          }));\n          setExistingEvents(eventsWithMetadata);\n        } else {\n          setExistingEvents([]);\n        }\n      } else {\n        console.error('Error fetching events:', response.data.message);\n      }\n    } catch (error) {\n      console.error('Error fetching events:', error);\n      setError('Failed to load events. Please try again.');\n    } finally {\n      setFetchingEvents(false);\n    }\n  }, [dateRange, formatDate, getCalendarColor, selectedCalendars, eventsCache, fetchingEvents, setError]);\n\n  // Recommendation system functions\n  const loadPopularCommands = () => {\n    try {\n      const savedCommands = localStorage.getItem('popularCommands');\n      if (savedCommands) {\n        const commands = JSON.parse(savedCommands);\n        // Get top 5 most used commands\n        const topCommands = commands.sort((a, b) => b.count - a.count).slice(0, 5);\n        if (topCommands.length > 0) {\n          // Format commands with icons and colors\n          const formattedCommands = topCommands.map((cmd, index) => {\n            // Detect command type to assign appropriate icon and color\n            let icon = ICONS.SCHEDULE;\n            let color = COLORS.BLUE;\n            const lowerText = cmd.text.toLowerCase();\n            if (lowerText.includes('free time') || lowerText.includes('availability')) {\n              icon = ICONS.FREE_TIME;\n              color = COLORS.GREEN;\n            } else if (lowerText.includes('meeting') || lowerText.includes('have') || lowerText.includes('scheduled')) {\n              icon = ICONS.MEETINGS;\n              color = COLORS.PURPLE;\n            } else if (lowerText.includes('break') || lowerText.includes('rest')) {\n              icon = ICONS.BREAK;\n              color = COLORS.ORANGE;\n            } else if (lowerText.includes('assignment') || lowerText.includes('work on')) {\n              icon = ICONS.ASSIGNMENT;\n              color = COLORS.RED;\n            } else if (lowerText.includes('remind') || lowerText.includes('notification')) {\n              icon = ICONS.REMINDER;\n              color = COLORS.ORANGE;\n            }\n            return {\n              text: cmd.text,\n              count: cmd.count,\n              icon,\n              color\n            };\n          });\n          setSuggestions(formattedCommands);\n          setShowRecommendations(true);\n        } else {\n          setSuggestions(DEFAULT_SUGGESTIONS);\n          setShowRecommendations(true);\n        }\n      } else {\n        // No saved commands, use defaults\n        setSuggestions(DEFAULT_SUGGESTIONS);\n        setShowRecommendations(true);\n      }\n    } catch (error) {\n      console.error('Error loading popular commands:', error);\n      setSuggestions(DEFAULT_SUGGESTIONS);\n      setShowRecommendations(true);\n    }\n  };\n  const trackCommand = commandText => {\n    try {\n      // Skip tracking empty commands\n      if (!commandText.trim()) return;\n\n      // Get existing commands or initialize empty array\n      const existingCommands = JSON.parse(localStorage.getItem('popularCommands') || '[]');\n\n      // Check if this command already exists\n      const existingIndex = existingCommands.findIndex(cmd => cmd.text.toLowerCase() === commandText.toLowerCase());\n      if (existingIndex >= 0) {\n        // Increment count for existing command\n        existingCommands[existingIndex].count += 1;\n        existingCommands[existingIndex].lastUsed = new Date().toISOString();\n      } else {\n        // Add new command\n        existingCommands.push({\n          text: commandText,\n          count: 1,\n          lastUsed: new Date().toISOString()\n        });\n      }\n\n      // Save back to localStorage\n      localStorage.setItem('popularCommands', JSON.stringify(existingCommands));\n\n      // Update suggestions\n      loadPopularCommands();\n    } catch (error) {\n      console.error('Error tracking command:', error);\n    }\n  };\n  const handleSelectSuggestion = suggestion => {\n    setText(suggestion);\n    // Focus the input field\n    document.querySelector('.chat-input textarea').focus();\n  };\n  const handleSubmit = useCallback(async e => {\n    e.preventDefault();\n    console.log(\"handleSubmit called with text:\", text);\n    if (!text.trim()) return;\n\n    // Track the command for the recommendation system\n    trackCommand(text);\n\n    // Add user message to chat\n    setChatMessages(prev => [...prev, {\n      sender: 'user',\n      content: text\n    }]);\n    setLoading(true);\n    setError(\"\");\n    setMessage(\"\");\n    setAvailableSlots([]);\n    setCalendarEvents([]);\n    setSelectedSlots([]);\n    try {\n      console.log(\"Making API call with text:\", text);\n      const response = await axios.post('http://127.0.0.1:5000/api/natural-language-event', {\n        text\n      });\n      console.log(\"API response:\", response.data);\n      if (response.data.success) {\n        // Handle the response in chat format\n        if (response.data.humanizedResponse) {\n          if (response.data.intent === \"check_free_time\") {\n            // For check_free_time intent with HTML\n            setChatMessages(prev => [...prev, {\n              sender: 'bot',\n              content: response.data.humanizedResponse\n            }]);\n            setText(\"\");\n          } else {\n            // For other intents with text response\n            setChatMessages(prev => [...prev, {\n              sender: 'bot',\n              content: response.data.humanizedResponse\n            }]);\n          }\n        }\n        if (response.data.intent === \"find_time\") {\n          setAvailableSlots(response.data.availableSlots);\n          setCalendarEvents(response.data.events || []);\n          setShowCalendar(true);\n\n          // Check if we have the insufficientTime flag\n          if (response.data.insufficientTime) {\n            // Add error message to chat\n            setChatMessages(prev => [...prev, {\n              sender: 'bot',\n              type: 'error',\n              content: `INSUFFICIENT TIME: ${response.data.humanizedResponse || response.data.message} Select these slots or try a different timeframe.`\n            }]);\n          } else if (!response.data.humanizedResponse) {\n            // Only set this default message if humanizedResponse wasn't already set\n            setChatMessages(prev => [...prev, {\n              sender: 'bot',\n              content: \"Here are suggested time slots on your calendar. Click on slots to select/deselect them for scheduling.\"\n            }]);\n          }\n          setEventDetails({\n            summary: response.data.calendar_title || getEventSummaryFromText(text),\n            description: text,\n            calendarId: response.data.predicted_calendar || \"primary\"\n          });\n        } else if (response.data.intent === \"view_events\") {\n          // Just display the humanized response for view_events, no calendar needed\n          setText(\"\");\n        } else if (response.data.intent === \"Create event\" && !response.data.humanizedResponse) {\n          // Fallback for create event if no humanizedResponse is available\n          setChatMessages(prev => [...prev, {\n            sender: 'bot',\n            type: 'success',\n            content: `Event created! ${response.data.eventLink ? `View it here: ${response.data.eventLink}` : ''}`\n          }]);\n          setText(\"\");\n        } else {\n          // For other intents or if we already set humanizedResponse\n          setText(\"\");\n        }\n      } else {\n        // Add error message to chat\n        setChatMessages(prev => [...prev, {\n          sender: 'bot',\n          type: 'error',\n          content: `Error: ${response.data.humanizedResponse || response.data.message}`\n        }]);\n      }\n    } catch (error) {\n      // Add error message to chat\n      setChatMessages(prev => {\n        var _error$response, _error$response$data;\n        return [...prev, {\n          sender: 'bot',\n          type: 'error',\n          content: `Error: ${((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || error.message}`\n        }];\n      });\n    } finally {\n      setLoading(false);\n    }\n  }, [text, setLoading, setText, setChatMessages, setAvailableSlots, setCalendarEvents, setSelectedSlots, setShowCalendar, setEventDetails]);\n\n  // Event handler for scheduling items - using useCallback to avoid dependency issues\n  const handleScheduleItem = useCallback(event => {\n    console.log(\"Custom event received:\", event.detail);\n    const {\n      type,\n      startTime,\n      endTime\n    } = event.detail;\n    const startDate = new Date();\n    const formattedDate = startDate.toLocaleDateString('en-US', {\n      month: 'long',\n      day: 'numeric',\n      year: 'numeric'\n    });\n    if (type === 'break') {\n      const newText = `Schedule a break on ${formattedDate} from ${startTime} to ${endTime}`;\n      console.log(\"Setting text for break:\", newText);\n      setText(newText);\n      // Submit after React has updated the state\n      setTimeout(() => {\n        handleSubmit({\n          preventDefault: () => {}\n        });\n      }, 50);\n    } else if (type === 'task') {\n      // Show prompt for task name\n      const taskName = prompt(\"What would you like to name this task?\", \"Work Session\");\n      if (taskName) {\n        const newText = `Schedule ${taskName} on ${formattedDate} from ${startTime} to ${endTime}`;\n        console.log(\"Setting text for task:\", newText);\n        setText(newText);\n        // Submit after React has updated the state\n        setTimeout(() => {\n          handleSubmit({\n            preventDefault: () => {}\n          });\n        }, 50);\n      }\n    }\n  }, [setText, handleSubmit]);\n\n  // Set up event listeners\n  useEffect(() => {\n    window.addEventListener('scheduleCalendarItem', handleScheduleItem);\n\n    // Add event listener for refreshCalendar event\n    const handleRefreshCalendar = () => {\n      if (showCalendar) {\n        console.log(\"Refreshing calendar events via refreshCalendar event\");\n        fetchExistingEvents();\n      }\n    };\n    window.addEventListener('refreshCalendar', handleRefreshCalendar);\n\n    // Clean up event listeners\n    return () => {\n      window.removeEventListener('scheduleCalendarItem', handleScheduleItem);\n      window.removeEventListener('refreshCalendar', handleRefreshCalendar);\n    };\n  }, [handleScheduleItem, fetchExistingEvents, showCalendar]);\n\n  // Fetch existing events when calendar is shown or date range changes\n  useEffect(() => {\n    if (showCalendar) {\n      console.log(\"Fetching existing events because calendar is shown or date range changed\");\n      fetchExistingEvents();\n    }\n  }, [showCalendar, dateRange, fetchExistingEvents]);\n\n  // Fetch all calendars and current preferences on mount\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        // Use Promise.all to fetch calendars and preferences in parallel\n        const [calendarsResponse, prefsResponse] = await Promise.all([axios.get('http://127.0.0.1:5000/api/get-calendars'), axios.get('http://127.0.0.1:5000/api/get-preferred-calendars')]);\n        if (!calendarsResponse.data.success) {\n          throw new Error(`Failed to fetch calendars: ${calendarsResponse.data.message || 'Unknown error'}`);\n        }\n        if (!prefsResponse.data.success) {\n          throw new Error(`Failed to fetch preferred calendars: ${prefsResponse.data.message || 'Unknown error'}`);\n        }\n        const allCalendars = calendarsResponse.data.calendars;\n        const preferredCals = prefsResponse.data.calendars;\n\n        // Update state all at once to avoid multiple re-renders\n        if (preferredCals.length > 0) {\n          // Ensure the saved preferences match the full calendar data\n          const syncedPrefs = preferredCals.map(pref => allCalendars.find(cal => cal.id === pref.id) || pref);\n          setCalendars(allCalendars);\n          setSelectedCalendars(syncedPrefs);\n        } else {\n          const primaryCal = allCalendars.find(cal => cal.primary);\n          setCalendars(allCalendars);\n          if (primaryCal) {\n            setSelectedCalendars([primaryCal]);\n          }\n        }\n      } catch (error) {\n        console.error('Error fetching data:', error);\n        setError(`Error loading calendars or preferences: ${error.message}`);\n      }\n    };\n    fetchData();\n  }, []);\n\n  // Send preferences to backend only when user changes them\n  useEffect(() => {\n    if (selectedCalendars.length > 0) {\n      const sendPreferences = async () => {\n        try {\n          // Debounce the API call to avoid excessive requests\n          const timeoutId = setTimeout(async () => {\n            const response = await axios.post('http://127.0.0.1:5000/api/set-preferred-calendars', {\n              calendars: selectedCalendars\n            });\n            if (!response.data.success) {\n              throw new Error(response.data.message);\n            }\n          }, 500); // Wait 500ms before sending the request\n\n          // Clear the timeout if the effect runs again before it fires\n          return () => clearTimeout(timeoutId);\n        } catch (error) {\n          console.error('Error setting preferred calendars:', error);\n          setError('Error saving calendar preferences.');\n        }\n      };\n      sendPreferences();\n    }\n  }, [selectedCalendars]);\n  const handleCalendarSelect = useCallback(cal => {\n    setSelectedCalendars(prev => {\n      // Check if we're adding or removing a calendar\n      const isRemovingCalendar = prev.some(selected => selected.id === cal.id);\n      const newCalendars = isRemovingCalendar ? prev.filter(selected => selected.id !== cal.id) : [...prev, cal];\n\n      // Clear events cache when calendars change\n      setEventsCache({});\n      return newCalendars;\n    });\n  }, [setEventsCache]);\n  const getEventSummaryFromText = text => {\n    const firstSentence = text.split('.')[0];\n    if (firstSentence.length <= 50) return firstSentence;\n    return firstSentence.substring(0, 50) + '...';\n  };\n  const handleEventClick = info => {\n    const {\n      event\n    } = info;\n\n    // Only handle suggested slots\n    if (event.extendedProps.suggestedSlot) {\n      const eventData = {\n        start: event.start.toISOString(),\n        end: event.end.toISOString()\n      };\n\n      // Toggle selection\n      setSelectedSlots(prev => {\n        const isAlreadySelected = prev.some(slot => slot.start === eventData.start && slot.end === eventData.end);\n        if (isAlreadySelected) {\n          // Remove from selection\n          return prev.filter(slot => !(slot.start === eventData.start && slot.end === eventData.end));\n        } else {\n          // Add to selection\n          return [...prev, eventData];\n        }\n      });\n\n      // Update event color based on selection\n      const isSelected = !selectedSlots.some(slot => slot.start === eventData.start && slot.end === eventData.end);\n      if (isSelected) {\n        event.setProp('backgroundColor', '#4caf50');\n        event.setProp('borderColor', '#2e7d32');\n        event.setProp('title', 'Selected Time');\n      } else {\n        event.setProp('backgroundColor', '#8bc34a');\n        event.setProp('borderColor', '#689f38');\n        event.setProp('title', 'Suggested Time');\n      }\n    } else {\n      // For existing events, show some details in a tooltip or alert\n      const eventTitle = event.title;\n      const eventTime = `${event.start.toLocaleTimeString()} - ${event.end.toLocaleTimeString()}`;\n      const calendarName = event.extendedProps.calendarName || 'Unknown Calendar';\n\n      // Simple alert for demonstration - in a real app, you might want a tooltip or modal\n      alert(`Event: ${eventTitle}\\nTime: ${eventTime}\\nCalendar: ${calendarName}`);\n    }\n  };\n  const calculateTotalHours = () => {\n    let totalMinutes = 0;\n    selectedSlots.forEach(slot => {\n      const start = new Date(slot.start);\n      const end = new Date(slot.end);\n      const diffMinutes = (end - start) / (1000 * 60);\n      totalMinutes += diffMinutes;\n    });\n    const hours = Math.floor(totalMinutes / 60);\n    const minutes = Math.floor(totalMinutes % 60);\n    return `${hours}h ${minutes}m`;\n  };\n  const handleScheduleSelected = async () => {\n    if (selectedSlots.length === 0) return;\n    setLoading(true);\n    try {\n      // Create multiple events, one for each selected slot\n      const promises = selectedSlots.map(slot => {\n        return axios.post('http://127.0.0.1:5000/api/schedule-selected-slot', {\n          selectedSlot: slot,\n          eventDetails\n        });\n      });\n      const results = await Promise.all(promises);\n      const allSuccessful = results.every(r => r.data.success);\n      if (allSuccessful) {\n        // Add success message to chat\n        setChatMessages(prev => [...prev, {\n          sender: 'bot',\n          type: 'success',\n          content: `All ${selectedSlots.length} events scheduled successfully!`\n        }]);\n        setText(\"\");\n        setShowCalendar(false);\n        setAvailableSlots([]);\n        setCalendarEvents([]);\n        setSelectedSlots([]);\n      } else {\n        // Add error message to chat\n        setChatMessages(prev => [...prev, {\n          sender: 'bot',\n          type: 'error',\n          content: `Error: Some events could not be scheduled.`\n        }]);\n      }\n    } catch (error) {\n      // Add error message to chat\n      setChatMessages(prev => {\n        var _error$response2, _error$response2$data;\n        return [...prev, {\n          sender: 'bot',\n          type: 'error',\n          content: `Error: ${((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.message) || error.message}`\n        }];\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n  const handleFindDifferentTimes = () => {\n    // Add message to chat\n    setChatMessages(prev => [...prev, {\n      sender: 'bot',\n      content: \"Let's find another time. Please provide more details:\"\n    }]);\n    setShowCalendar(false);\n    setAvailableSlots([]);\n    setCalendarEvents([]);\n    setSelectedSlots([]);\n  };\n  const handleDatesSet = dateInfo => {\n    console.log(\"Calendar dates changed:\", dateInfo.startStr, \"to\", dateInfo.endStr);\n    setDateRange({\n      start: dateInfo.start,\n      end: dateInfo.end\n    });\n\n    // If calendar is currently showing, fetch events for the new date range\n    if (showCalendar) {\n      console.log(\"Fetching events for new date range\");\n      fetchExistingEvents();\n    }\n  };\n\n  // Optimize to avoid recalculation on each render\n  const getAllEvents = useCallback(() => {\n    // Start with existing events\n    const allEvents = [...existingEvents];\n\n    // Add suggested slots with updated colors based on selection\n    if (calendarEvents.length > 0) {\n      calendarEvents.forEach(event => {\n        const isSelected = selectedSlots.some(slot => slot.start === event.start && slot.end === event.end);\n        allEvents.push({\n          ...event,\n          backgroundColor: isSelected ? '#4caf50' : '#8bc34a',\n          borderColor: isSelected ? '#2e7d32' : '#689f38',\n          textColor: '#ffffff',\n          title: isSelected ? 'Selected Time' : 'Suggested Time',\n          display: 'block',\n          extendedProps: {\n            ...event.extendedProps,\n            suggestedSlot: true\n          }\n        });\n      });\n    }\n    return allEvents;\n  }, [existingEvents, calendarEvents, selectedSlots]);\n\n  // Precalculate events to avoid useMemo in render\n  const currentEvents = getAllEvents();\n\n  // Render calendar in a chat message\n  const renderCalendarMessage = () => {\n    if (!showCalendar) return null;\n    const currentEvents = getAllEvents();\n    return /*#__PURE__*/_jsxDEV(ChatMessage, {\n      sender: \"bot\",\n      isCalendarView: true,\n      className: \"calendar-message\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"calendar-view w-full\",\n        children: [selectedSlots.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-blue-50 border border-blue-100 rounded-lg p-4 mb-4 text-blue-800 font-medium\",\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [\"Selected \", selectedSlots.length, \" slot(s) - Total time: \", calculateTotalHours()]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 962,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 961,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"calendar-legend\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"legend-section\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"legend-item\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"legend-color suggested-event-color\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 969,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Suggested Work Slots\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 970,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 968,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"legend-item\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"legend-color selected-event-color\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 973,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Selected Work Slots\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 974,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 972,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 967,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"legend-section\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"legend-title\",\n              children: \"Your Calendars:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 980,\n              columnNumber: 15\n            }, this), selectedCalendars.map(cal => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"legend-item\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"legend-color\",\n                style: {\n                  backgroundColor: cal.backgroundColor || getCalendarColor(cal.id),\n                  border: `1px solid ${cal.borderColor || getCalendarColor(cal.id, true)}`\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 983,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: cal.summary\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 990,\n                columnNumber: 19\n              }, this)]\n            }, cal.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 982,\n              columnNumber: 17\n            }, this))]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 979,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 965,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(CalendarComponent, {\n          events: currentEvents,\n          handleEventClick: handleEventClick,\n          handleDatesSet: handleDatesSet,\n          loading: loading || fetchingEvents,\n          renderEventContent: renderEventContent\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 997,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex mt-6 space-x-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleScheduleSelected,\n            disabled: selectedSlots.length === 0 || loading,\n            className: `\n                px-6 py-3 rounded-lg font-medium flex items-center justify-center\n                ${selectedSlots.length === 0 || loading ? 'bg-gray-300 cursor-not-allowed text-gray-500' : 'bg-green-600 hover:bg-green-700 text-white shadow-md hover:shadow-lg transition-all duration-200'}\n              `,\n            children: loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center\",\n              children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                className: \"animate-spin -ml-1 mr-2 h-5 w-5\",\n                xmlns: \"http://www.w3.org/2000/svg\",\n                fill: \"none\",\n                viewBox: \"0 0 24 24\",\n                children: [/*#__PURE__*/_jsxDEV(\"circle\", {\n                  className: \"opacity-25\",\n                  cx: \"12\",\n                  cy: \"12\",\n                  r: \"10\",\n                  stroke: \"currentColor\",\n                  strokeWidth: \"4\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1019,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n                  className: \"opacity-75\",\n                  fill: \"currentColor\",\n                  d: \"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1020,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1018,\n                columnNumber: 19\n              }, this), \"Scheduling...\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1017,\n              columnNumber: 17\n            }, this) : `Schedule ${selectedSlots.length} Selected Time${selectedSlots.length === 1 ? '' : 's'}`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1006,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleFindDifferentTimes,\n            disabled: loading,\n            className: \"px-6 py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium shadow-md hover:shadow-lg transition-all duration-200\",\n            children: \"Find Different Times\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1026,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1005,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 959,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 958,\n      columnNumber: 7\n    }, this);\n  };\n\n  // Format events in a user-friendly way\n  const formatStyledEventList = responseText => {\n    console.log(\"Formatting response:\", responseText); // Debug to see what's being processed\n\n    // First, check for specific format with Cmpt 310 or other course names\n    if (responseText.includes(\"Cmpt 310\") || responseText.includes(\"CMPT 310\")) {\n      try {\n        // Extract date more flexibly\n        let dateMatch = responseText.match(/for\\s+([A-Za-z]+\\s+\\d+(?:st|nd|rd|th)?,\\s+\\d{4})/i);\n        const dateStr = dateMatch ? dateMatch[1] : \"Today\";\n\n        // Simpler regex to match formatted times and course info\n        const eventPattern = /\\*\\*([^*]+)\\*\\*:\\s*([^*\\n]+?)(?:\\sin\\s+([^*\\n]*))?(?=\\s*\\*\\*|\\s*$)/g;\n        let match;\n        const events = [];\n        while ((match = eventPattern.exec(responseText)) !== null) {\n          console.log(\"Matched event:\", match); // Debug\n          const timeRange = match[1].trim();\n          const title = match[2].trim();\n          const location = match[3] ? match[3].trim() : '';\n          events.push({\n            timeRange,\n            title,\n            location,\n            duration: calculateDuration(timeRange)\n          });\n        }\n\n        // If we couldn't extract events with the regex, try a direct approach for the specific format\n        if (events.length === 0 && responseText.includes(\"AM\") && responseText.includes(\"PM\")) {\n          // Direct parsing for the specific format in the image\n          const timeMatch = responseText.match(/(\\d+:\\d+\\s*(?:AM|PM)\\s*-\\s*\\d+:\\d+\\s*(?:AM|PM))/i);\n          const courseMatch = responseText.match(/Cmpt\\s+\\d+|CMPT\\s+\\d+/i);\n          const locationMatch = responseText.match(/at\\s+([A-Z]+\\s+\\d+)/i);\n          if (timeMatch && courseMatch) {\n            events.push({\n              timeRange: timeMatch[1].trim(),\n              title: courseMatch[0].trim() + (responseText.includes(\"OH\") ? \" Office Hours\" : \"\"),\n              location: locationMatch ? locationMatch[1].trim() : \"\",\n              duration: calculateDuration(timeMatch[1].trim())\n            });\n            console.log(\"Direct parse event:\", events[0]); // Debug\n          }\n        }\n\n        // If we extracted events, format them nicely\n        if (events.length > 0) {\n          // Generate intro text\n          const introMatch = responseText.match(/^([^*]+)/);\n          const introText = introMatch ? introMatch[0].trim() : `Here's your schedule for ${dateStr}:`;\n          return generateEventHTML(introText, dateStr, events);\n        }\n      } catch (error) {\n        console.error(\"Error formatting events:\", error);\n      }\n    }\n\n    // Check if this is a schedule/calendar response with events\n    if ((responseText.includes(\"schedule\") || responseText.includes(\"calendar\") || responseText.includes(\"looks like for\") || responseText.includes(\"have\") || responseText.includes(\"Monday\") || responseText.includes(\"monday\")) && (responseText.includes(\"**\") || responseText.includes(\"AM\") || responseText.includes(\"PM\"))) {\n      try {\n        // Extract date\n        let dateMatch = responseText.match(/(?:for|on)\\s+([A-Za-z]+\\s+\\d+(?:st|nd|rd|th)?,\\s+\\d{4})/i);\n        const dateStr = dateMatch ? dateMatch[1] : responseText.toLowerCase().includes(\"monday\") ? \"Monday\" : \"Today\";\n\n        // Parse events from the text - improved regex pattern to better capture events\n        const eventPattern = /\\*\\*([0-9:.APM\\s-]+)\\*\\*:\\s*([^*\\n]+?)(?:\\sin\\s+([^*\\n]*))?(?=\\s*\\*\\*|\\s*$)/g;\n        let match;\n        const events = [];\n        while ((match = eventPattern.exec(responseText)) !== null) {\n          const timeRange = match[1].trim();\n          const title = match[2].trim();\n          const location = match[3] ? match[3].trim() : '';\n          events.push({\n            timeRange,\n            title,\n            location,\n            duration: calculateDuration(timeRange)\n          });\n        }\n\n        // Try alternative pattern if no events found\n        if (events.length === 0) {\n          const altPattern = /(\\d+(?::\\d+)?\\s*(?:AM|PM)\\s*-\\s*\\d+(?::\\d+)?\\s*(?:AM|PM))[\\s:]*([^()\\n,]+)(?:\\s+in\\s+([^()\\n,]+))?/gi;\n          while ((match = altPattern.exec(responseText)) !== null) {\n            events.push({\n              timeRange: match[1].trim(),\n              title: match[2].trim(),\n              location: match[3] ? match[3].trim() : '',\n              duration: calculateDuration(match[1].trim())\n            });\n          }\n        }\n\n        // If we extracted events, format them nicely\n        if (events.length > 0) {\n          // Generate intro text\n          const introMatch = responseText.match(/^([^*]+)/);\n          const introText = introMatch ? introMatch[0].trim() : `Here's your schedule for ${dateStr}:`;\n          return generateEventHTML(introText, dateStr, events);\n        } else {\n          // If we still couldn't find events, fall back to default formatting\n          return defaultStyledFormat(responseText);\n        }\n      } catch (error) {\n        console.error(\"Error formatting events:\", error);\n        return defaultStyledFormat(responseText);\n      }\n    }\n\n    // For regular text responses, make them more visually interesting\n    if (!responseText.includes(\"<div\") && !responseText.includes(\"<p\") && !responseText.includes(\"<ul\")) {\n      // If it mentions free time, use a special format\n      if (responseText.toLowerCase().includes(\"free time\") || responseText.toLowerCase().includes(\"available\") || responseText.toLowerCase().includes(\"time slot\")) {\n        return generateFreeTimeHTML(responseText);\n      }\n\n      // If it's a confirmation or completion message\n      if (responseText.toLowerCase().includes(\"scheduled\") || responseText.toLowerCase().includes(\"created\") || responseText.toLowerCase().includes(\"added\")) {\n        return generateConfirmationHTML(responseText);\n      }\n\n      // Default enhanced format for other responses\n      return defaultStyledFormat(responseText);\n    }\n\n    // Return original if no formatting applied\n    return responseText;\n  };\n\n  // Helper function to calculate duration from a time range\n  const calculateDuration = timeRange => {\n    if (!timeRange || !timeRange.includes(\"-\")) return \"\";\n    try {\n      const [startTime, endTime] = timeRange.split(\"-\").map(t => t.trim());\n      const parseTime = timeStr => {\n        const [time, modifier] = timeStr.split(/\\s+/);\n        let [hours, minutes] = (time || \"\").split(':').map(Number);\n        minutes = minutes || 0;\n        if (modifier && modifier.toUpperCase() === 'PM' && hours < 12) hours += 12;\n        if (modifier && modifier.toUpperCase() === 'AM' && hours === 12) hours = 0;\n        return hours * 60 + minutes;\n      };\n      const startMinutes = parseTime(startTime);\n      const endMinutes = parseTime(endTime);\n      const durationMinutes = endMinutes - startMinutes;\n      if (durationMinutes > 0) {\n        const hours = Math.floor(durationMinutes / 60);\n        const mins = durationMinutes % 60;\n        return hours > 0 ? `${hours} hour${hours > 1 ? 's' : ''}${mins > 0 ? ` ${mins} min` : ''}` : `${mins} min`;\n      }\n      return \"\";\n    } catch (e) {\n      console.error(\"Error calculating duration:\", e);\n      return \"\";\n    }\n  };\n\n  // Helper function to generate HTML for events\n  const generateEventHTML = (introText, dateStr, events) => {\n    return `\n      <div>\n        <p>${introText}</p>\n        <div class=\"styled-event-list\">\n          <div class=\"event-date\">${dateStr}</div>\n          ${events.map(event => {\n      // Determine background color based on event title (for courses)\n      let bgColor = '#e5edff'; // default blue background\n      let iconColor = '#3b82f6'; // default blue icon\n\n      if (event.title.includes('CMPT 310') || event.title.includes('Cmpt 310')) {\n        bgColor = '#f3e8ff'; // purple for CMPT 310\n        iconColor = '#8b5cf6';\n      } else if (event.title.includes('CMPT 213') || event.title.includes('Cmpt 213')) {\n        bgColor = '#e0f2fe'; // light blue for CMPT 213\n        iconColor = '#0ea5e9';\n      } else if (event.title.includes('CMPT 276') || event.title.includes('Cmpt 276')) {\n        bgColor = '#dcfce7'; // green for CMPT 276\n        iconColor = '#22c55e';\n      } else if (event.title.includes('CMPT 105W') || event.title.includes('Cmpt 105W')) {\n        bgColor = '#ffedd5'; // orange for CMPT 105W\n        iconColor = '#f97316';\n      } else if (event.title.includes('OH') || event.title.includes('Office Hours')) {\n        bgColor = '#ffe4e6'; // pink for Office Hours\n        iconColor = '#e11d48';\n      }\n      return `\n            <div class=\"event-item\">\n              <div class=\"event-item-icon\" style=\"background-color: ${bgColor}; color: ${iconColor};\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                  <rect x=\"3\" y=\"4\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\n                  <line x1=\"16\" y1=\"2\" x2=\"16\" y2=\"6\"></line>\n                  <line x1=\"8\" y1=\"2\" x2=\"8\" y2=\"6\"></line>\n                  <line x1=\"3\" y1=\"10\" x2=\"21\" y2=\"10\"></line>\n                </svg>\n              </div>\n              <div>\n                <div class=\"event-time\">${event.timeRange}</div>\n                <div class=\"event-content\">\n                  <div class=\"event-title\">${event.title}</div>\n                  ${event.location ? `\n                    <div class=\"event-location\">\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                        <path d=\"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z\"></path>\n                        <circle cx=\"12\" cy=\"10\" r=\"3\"></circle>\n                      </svg>\n                      ${event.location}\n                    </div>\n                  ` : ''}\n                  ${event.duration ? `<div class=\"event-duration\">${event.duration}</div>` : ''}\n                </div>\n              </div>\n            </div>\n            `;\n    }).join('')}\n        </div>\n      </div>\n    `;\n  };\n\n  // Helper function for free time format\n  const generateFreeTimeHTML = responseText => {\n    return `\n      <div class=\"styled-event-list\">\n        <div class=\"event-item\">\n          <div class=\"event-item-icon\" style=\"background-color: #ebf7ee; color: #34d399;\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n              <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"></path>\n              <polyline points=\"22 4 12 14.01 9 11.01\"></polyline>\n            </svg>\n          </div>\n          <div class=\"event-content\">\n            <p>${responseText}</p>\n          </div>\n        </div>\n      </div>\n    `;\n  };\n\n  // Helper function for confirmation format\n  const generateConfirmationHTML = responseText => {\n    return `\n      <div class=\"styled-event-list\">\n        <div class=\"event-item\">\n          <div class=\"event-item-icon\" style=\"background-color: #e5edff; color: #3b82f6;\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n              <polyline points=\"20 6 9 17 4 12\"></polyline>\n            </svg>\n          </div>\n          <div class=\"event-content\">\n            <p>${responseText}</p>\n          </div>\n        </div>\n      </div>\n    `;\n  };\n\n  // Helper function for default format\n  const defaultStyledFormat = responseText => {\n    return `\n      <div class=\"styled-event-list\">\n        <div class=\"event-item\">\n          <div class=\"event-item-icon\" style=\"background-color: #f5f3ff; color: #8b5cf6;\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n              <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n              <line x1=\"12\" y1=\"16\" x2=\"12\" y2=\"12\"></line>\n              <line x1=\"12\" y1=\"8\" x2=\"12.01\" y2=\"8\"></line>\n            </svg>\n          </div>\n          <div class=\"event-content\">\n            <p>${responseText}</p>\n          </div>\n        </div>\n      </div>\n    `;\n  };\n\n  // Render message content based on type\n  const renderMessage = (message, index) => {\n    if (message.type === 'welcome') {\n      return /*#__PURE__*/_jsxDEV(WelcomeMessage, {}, index, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1340,\n        columnNumber: 14\n      }, this);\n    }\n    if (message.type === 'error') {\n      return /*#__PURE__*/_jsxDEV(ChatMessage, {\n        sender: message.sender,\n        content: `<div class=\"error-content\">${message.content}</div>`\n      }, index, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1345,\n        columnNumber: 9\n      }, this);\n    }\n    if (message.type === 'success') {\n      return /*#__PURE__*/_jsxDEV(ChatMessage, {\n        sender: message.sender,\n        content: `<div class=\"success-content\">${message.content}</div>`\n      }, index, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1355,\n        columnNumber: 9\n      }, this);\n    }\n\n    // Format event lists in responses\n    const formattedContent = message.sender === 'bot' ? formatStyledEventList(message.content) : message.content;\n    return /*#__PURE__*/_jsxDEV(ChatMessage, {\n      sender: message.sender,\n      content: formattedContent\n    }, index, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1369,\n      columnNumber: 7\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"w-full h-full\",\n    children: /*#__PURE__*/_jsxDEV(ChatContainer, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"relative\",\n        children: [/*#__PURE__*/_jsxDEV(ChatHeader, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1381,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(SettingsButton, {\n          onClick: () => setShowSettings(!showSettings),\n          isOpen: showSettings\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1382,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1380,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `settings-transition ${showSettings ? 'settings-open' : 'settings-closed'}`,\n        children: showSettings && /*#__PURE__*/_jsxDEV(CalendarSettings, {\n          calendars: calendars,\n          selected: selectedCalendars,\n          onSelect: handleCalendarSelect,\n          disabled: loading\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1390,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1388,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ChatMessages, {\n        children: [chatMessages.map((msg, idx) => renderMessage(msg, idx)), showCalendar && renderCalendarMessage()]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1399,\n        columnNumber: 9\n      }, this), showRecommendations && suggestions.length > 0 && /*#__PURE__*/_jsxDEV(RecommendationBar, {\n        suggestions: suggestions,\n        onSelectSuggestion: handleSelectSuggestion\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1405,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(ChatInput, {\n        value: text,\n        onChange: e => setText(e.target.value),\n        onSubmit: handleSubmit,\n        loading: loading\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1411,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1379,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 1378,\n    columnNumber: 5\n  }, this);\n}\n_s(NaturalLanguageForm, \"zDIILi7OcBg7qFKvU/KN0ZNmZoc=\");\n_c3 = NaturalLanguageForm;\nfunction App() {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App w-full\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      className: \"app-title\",\n      children: \"Calendar Companion\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1425,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"app-container\",\n      children: /*#__PURE__*/_jsxDEV(Suspense, {\n        fallback: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-center p-10 text-white\",\n          children: \"Loading application...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1427,\n          columnNumber: 29\n        }, this),\n        children: /*#__PURE__*/_jsxDEV(NaturalLanguageForm, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1428,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1427,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1426,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"script\", {\n      dangerouslySetInnerHTML: {\n        __html: `\n          // Directly define functions in the global scope\n          window.scheduleBreak = function(startTime, endTime) {\n            console.log(\"DOM scheduleBreak called with:\", startTime, endTime);\n            if (window.dispatchEvent) {\n              window.dispatchEvent(\n                new CustomEvent('scheduleCalendarItem', {\n                  detail: {\n                    type: 'break',\n                    startTime,\n                    endTime\n                  }\n                })\n              );\n            }\n          };\n          \n          window.scheduleTask = function(startTime, endTime) {\n            console.log(\"DOM scheduleTask called with:\", startTime, endTime);\n            if (window.dispatchEvent) {\n              window.dispatchEvent(\n                new CustomEvent('scheduleCalendarItem', {\n                  detail: {\n                    type: 'task',\n                    startTime,\n                    endTime\n                  }\n                })\n              );\n            }\n          };\n          \n          // Duration selector functions\n          window.showDurationSelector = function(startTime, endTime, selectorId, displayId, sliderId) {\n            console.log(\"Showing duration selector\", selectorId);\n            const durationSelector = document.getElementById(selectorId);\n            if (durationSelector) {\n              durationSelector.style.display = 'block';\n            } else {\n              console.error(\"Duration selector element not found:\", selectorId);\n            }\n          };\n          \n          window.updateDurationDisplay = function(minutes, displayId) {\n            console.log(\"Updating duration display to\", minutes, \"for\", displayId);\n            const durationDisplay = document.getElementById(displayId);\n            if (!durationDisplay) {\n              console.error(\"Duration display element not found:\", displayId);\n              return;\n            }\n            \n            let display = \"\";\n            if (minutes >= 60) {\n              const hours = Math.floor(minutes / 60);\n              const remainingMinutes = minutes % 60;\n              display = hours + \" hour\" + (hours > 1 ? \"s\" : \"\");\n              if (remainingMinutes > 0) {\n                display += \" \" + remainingMinutes + \" min\";\n              }\n            } else {\n              display = minutes + \" min\";\n            }\n            durationDisplay.textContent = display;\n          };\n          \n          window.scheduleBreakWithDuration = function(startTime, endTime, sliderId) {\n            console.log(\"Scheduling break with duration using slider\", sliderId);\n            const durationSlider = document.getElementById(sliderId);\n            if (!durationSlider) {\n              console.error(\"Duration slider not found:\", sliderId);\n              return;\n            }\n            \n            const durationMinutes = durationSlider.value;\n            console.log(\"Duration selected:\", durationMinutes);\n            \n            const startDateTime = new Date();\n            const [startHours, startMinutes] = startTime.split(':').map(Number);\n            startDateTime.setHours(startHours, startMinutes, 0);\n            \n            // Calculate end time based on selected duration\n            const endDateTime = new Date(startDateTime);\n            endDateTime.setMinutes(startDateTime.getMinutes() + parseInt(durationMinutes));\n            \n            const formattedEndTime = endDateTime.getHours().toString().padStart(2, '0') + ':' + \n                                  endDateTime.getMinutes().toString().padStart(2, '0');\n            \n            console.log(\"Calculated end time:\", formattedEndTime);\n            \n            // Call the existing scheduleBreak function\n            window.scheduleBreak(startTime, formattedEndTime);\n          };\n          \n          window.cancelDurationSelection = function(selectorId) {\n            console.log(\"Canceling duration selection for\", selectorId);\n            const durationSelector = document.getElementById(selectorId);\n            if (durationSelector) {\n              durationSelector.style.display = 'none';\n            } else {\n              console.error(\"Duration selector element not found:\", selectorId);\n            }\n          };\n          \n          console.log(\"Inline scheduling functions defined and attached to window object\");\n        `\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1432,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1424,\n    columnNumber: 5\n  }, this);\n}\n_c4 = App;\nexport default App;\nvar _c, _c2, _c3, _c4;\n$RefreshReg$(_c, \"CalendarComponent$memo\");\n$RefreshReg$(_c2, \"CalendarComponent\");\n$RefreshReg$(_c3, \"NaturalLanguageForm\");\n$RefreshReg$(_c4, \"App\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","memo","useMemo","Suspense","lazy","useRef","axios","ChatHeader","ChatContainer","ChatMessages","ChatMessage","ChatInput","SettingsButton","CalendarSettings","WelcomeMessage","CalendarSelectionComponent","RecommendationBar","FullCalendar","dayGridPlugin","timeGridPlugin","interactionPlugin","jsxDEV","_jsxDEV","ICONS","SCHEDULE","FREE_TIME","MEETINGS","BREAK","ASSIGNMENT","REMINDER","COLORS","BLUE","GREEN","ORANGE","PURPLE","RED","DEFAULT_SUGGESTIONS","text","color","icon","setupGlobalFunctions","window","scheduleBreak","startTime","endTime","console","log","dispatchEvent","CustomEvent","detail","type","scheduleTask","renderEventContent","eventInfo","_eventInfo$event$exte","_eventInfo$event$exte2","_eventInfo$event$exte3","_eventInfo$event$exte4","isSuggested","event","extendedProps","suggestedSlot","isExisting","existingEvent","timeText","includes","times","split","trim","calendarName","title","summary","className","children","fileName","_jsxFileName","lineNumber","columnNumber","CalendarComponent","_c","events","handleEventClick","handleDatesSet","loading","plugins","initialView","headerToolbar","left","center","right","eventClick","eventContent","height","nowIndicator","datesSet","slotMinTime","slotMaxTime","eventTimeFormat","hour","minute","meridiem","slotLabelFormat","hour12","allDaySlot","eventDisplay","eventBackgroundColor","eventBorderColor","eventTextColor","displayEventTime","displayEventEnd","forceEventDuration","eventMinHeight","lazyFetching","_c2","displayName","NaturalLanguageForm","_s","setText","setLoading","message","setMessage","error","setError","availableSlots","setAvailableSlots","calendarEvents","setCalendarEvents","existingEvents","setExistingEvents","showCalendar","setShowCalendar","eventDetails","setEventDetails","selectedSlots","setSelectedSlots","eventsCache","setEventsCache","fetchingEvents","setFetchingEvents","chatMessages","setChatMessages","showSettings","setShowSettings","suggestions","setSuggestions","showRecommendations","setShowRecommendations","sender","loadPopularCommands","calendars","setCalendars","selectedCalendars","setSelectedCalendars","dateRange","setDateRange","start","Date","end","setDate","getDate","formatDate","date","d","month","getMonth","day","year","getFullYear","length","join","getCalendarColor","calendarId","darker","calendar","find","cal","id","backgroundColor","startsWith","rgbaPattern","match","darkenColor","amount","rgbPattern","r","parseInt","g","b","Math","max","floor","replace","substring","toString","padStart","e","fetchExistingEvents","forceRefresh","startDate","endDate","process","env","NODE_ENV","calendarIds","map","cacheKey","expiry","now","data","retries","maxRetries","response","get","err","currentRetry","Promise","resolve","setTimeout","pow","success","tomorrow","toISOString","eventsWithMetadata","borderColor","textColor","classNames","prev","savedCommands","localStorage","getItem","commands","JSON","parse","topCommands","sort","a","count","slice","formattedCommands","cmd","index","lowerText","toLowerCase","trackCommand","commandText","existingCommands","existingIndex","findIndex","lastUsed","push","setItem","stringify","handleSelectSuggestion","suggestion","document","querySelector","focus","handleSubmit","preventDefault","content","post","humanizedResponse","intent","insufficientTime","calendar_title","getEventSummaryFromText","description","predicted_calendar","eventLink","_error$response","_error$response$data","handleScheduleItem","formattedDate","toLocaleDateString","newText","taskName","prompt","addEventListener","handleRefreshCalendar","removeEventListener","fetchData","calendarsResponse","prefsResponse","all","Error","allCalendars","preferredCals","syncedPrefs","pref","primaryCal","primary","sendPreferences","timeoutId","clearTimeout","handleCalendarSelect","isRemovingCalendar","some","selected","newCalendars","filter","firstSentence","info","eventData","isAlreadySelected","slot","isSelected","setProp","eventTitle","eventTime","toLocaleTimeString","alert","calculateTotalHours","totalMinutes","forEach","diffMinutes","hours","minutes","handleScheduleSelected","promises","selectedSlot","results","allSuccessful","every","_error$response2","_error$response2$data","handleFindDifferentTimes","dateInfo","startStr","endStr","getAllEvents","allEvents","display","currentEvents","renderCalendarMessage","isCalendarView","style","border","onClick","disabled","xmlns","fill","viewBox","cx","cy","stroke","strokeWidth","formatStyledEventList","responseText","dateMatch","dateStr","eventPattern","exec","timeRange","location","duration","calculateDuration","timeMatch","courseMatch","locationMatch","introMatch","introText","generateEventHTML","altPattern","defaultStyledFormat","generateFreeTimeHTML","generateConfirmationHTML","t","parseTime","timeStr","time","modifier","Number","toUpperCase","startMinutes","endMinutes","durationMinutes","mins","bgColor","iconColor","renderMessage","formattedContent","isOpen","onSelect","msg","idx","onSelectSuggestion","value","onChange","target","onSubmit","_c3","App","fallback","dangerouslySetInnerHTML","__html","_c4","$RefreshReg$"],"sources":["/Users/Rushik/Documents/Projects/caledar-example/Calendar-app-latest-working/src/App.jsx"],"sourcesContent":["import React, { useState, useEffect, useCallback, memo, useMemo, Suspense, lazy, useRef } from 'react';\nimport axios from 'axios';\nimport './App.css';\n\n// Import our Chat UI components instead of the old NewUI\nimport { ChatHeader, ChatContainer, ChatMessages, ChatMessage, ChatInput, SettingsButton, CalendarSettings, WelcomeMessage, CalendarSelectionComponent, RecommendationBar } from './ChatUI';\n\nimport FullCalendar from '@fullcalendar/react';\nimport dayGridPlugin from '@fullcalendar/daygrid';\nimport timeGridPlugin from '@fullcalendar/timegrid';\nimport interactionPlugin from '@fullcalendar/interaction';\n\n// SVG Path Icons for recommendation buttons\nconst ICONS = {\n  SCHEDULE: \"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\",\n  FREE_TIME: \"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\",\n  MEETINGS: \"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\",\n  BREAK: \"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\",\n  ASSIGNMENT: \"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\",\n  REMINDER: \"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9\"\n};\n\n// Colors for suggestion pills\nconst COLORS = {\n  BLUE: 'rgba(99, 179, 237, 0.2)',    // Vibrant blue\n  GREEN: 'rgba(72, 187, 120, 0.2)',   // Fresh green\n  ORANGE: 'rgba(246, 173, 85, 0.2)',  // Warm orange\n  PURPLE: 'rgba(159, 122, 234, 0.2)', // Rich purple\n  RED: 'rgba(245, 101, 101, 0.2)'     // Bright red\n};\n\n// Popular command suggestions\nconst DEFAULT_SUGGESTIONS = [\n  { text: \"Schedule a meeting tomorrow at 2pm\", color: COLORS.BLUE, icon: ICONS.SCHEDULE },\n  { text: \"Find me free time this week\", color: COLORS.GREEN, icon: ICONS.FREE_TIME },\n  { text: \"What meetings do I have today?\", color: COLORS.PURPLE, icon: ICONS.MEETINGS },\n  { text: \"Schedule a 30-minute break\", color: COLORS.ORANGE, icon: ICONS.BREAK },\n  { text: \"Find time to work on my assignment\", color: COLORS.RED, icon: ICONS.ASSIGNMENT }\n];\n\n// Define the script at global level to ensure the functions are globally accessible\nconst setupGlobalFunctions = () => {\n  if (typeof window !== 'undefined') {\n    // Create a custom event for scheduling breaks\n    window.scheduleBreak = (startTime, endTime) => {\n      console.log(\"scheduleBreak called with:\", startTime, endTime);\n      // Dispatch a custom event that the React component can listen for\n      window.dispatchEvent(\n        new CustomEvent('scheduleCalendarItem', {\n          detail: {\n            type: 'break',\n            startTime,\n            endTime\n          }\n        })\n      );\n    };\n    \n    // Create a custom event for scheduling tasks  \n    window.scheduleTask = (startTime, endTime) => {\n      console.log(\"scheduleTask called with:\", startTime, endTime);\n      window.dispatchEvent(\n        new CustomEvent('scheduleCalendarItem', {\n          detail: {\n            type: 'task',\n            startTime,\n            endTime\n          }\n        })\n      );\n    };\n    \n    // Log to verify functions are attached\n    console.log(\"Global scheduling functions attached:\", \n      typeof window.scheduleBreak === 'function', \n      typeof window.scheduleTask === 'function');\n  }\n};\n\n// Memoize the renderEventContent function to avoid recreating it on each render\nconst renderEventContent = (eventInfo) => {\n  // Determine if this is a suggested slot or existing event\n  const isSuggested = eventInfo.event.extendedProps?.suggestedSlot === true;\n  const isExisting = eventInfo.event.extendedProps?.existingEvent === true;\n  \n  // Format the time more cleanly\n  let timeText = eventInfo.timeText || '';\n  if (timeText.includes('-')) {\n    // Simplify time range display\n    const times = timeText.split('-');\n    timeText = times[0].trim() + ' - ' + times[1].trim();\n  }\n  \n  // Get the calendar name if available\n  let calendarName = '';\n  if (isExisting && eventInfo.event.extendedProps?.calendarName) {\n    calendarName = `(${eventInfo.event.extendedProps.calendarName})`;\n  }\n  \n  // Get the event title with fallback options\n  const title = eventInfo.event.title || \n                eventInfo.event.extendedProps?.summary || \n                (isSuggested ? 'Suggested Time' : 'Event');\n  \n  return (\n    <div className={`event-content ${isSuggested ? 'suggested-event' : 'existing-event'}`}>\n      <b>{timeText}</b>\n      <i>{title} {calendarName}</i>\n    </div>\n  );\n};\n\n// Define the Calendar component outside of the main component\nconst CalendarComponent = memo(({ \n  events, \n  handleEventClick, \n  handleDatesSet, \n  loading,\n  renderEventContent \n}) => {\n  return (\n    <div className={`calendar-container ${loading ? 'loading' : ''}`}>\n      <FullCalendar\n        plugins={[dayGridPlugin, timeGridPlugin, interactionPlugin]}\n        initialView=\"timeGridWeek\"\n        headerToolbar={{\n          left: 'prev,next today',\n          center: 'title',\n          right: 'dayGridMonth,timeGridWeek,timeGridDay'\n        }}\n        events={events}\n        eventClick={handleEventClick}\n        eventContent={renderEventContent}\n        height=\"800px\"\n        nowIndicator={true}\n        datesSet={handleDatesSet}\n        slotMinTime=\"07:00:00\"\n        slotMaxTime=\"23:00:00\"\n        eventTimeFormat={{\n          hour: 'numeric',\n          minute: '2-digit',\n          meridiem: 'short'\n        }}\n        slotLabelFormat={{\n          hour: 'numeric',\n          minute: '2-digit',\n          hour12: true\n        }}\n        allDaySlot={false}\n        eventDisplay=\"block\"\n        eventBackgroundColor=\"#4285f4\"\n        eventBorderColor=\"#3b78e7\"\n        eventTextColor=\"#ffffff\"\n        displayEventTime={true}\n        displayEventEnd={true}\n        forceEventDuration={true}\n        eventMinHeight={30}\n        lazyFetching={true}\n      />\n    </div>\n  );\n});\n\nCalendarComponent.displayName = 'CalendarComponent';\n\n// Note: We're using CalendarSelectionComponent from ChatUI.jsx\n\nfunction NaturalLanguageForm() {\n  const [text, setText] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [message, setMessage] = useState(\"\");\n  const [error, setError] = useState(\"\");\n  // eslint-disable-next-line no-unused-vars\n  const [availableSlots, setAvailableSlots] = useState([]);\n  const [calendarEvents, setCalendarEvents] = useState([]);\n  const [existingEvents, setExistingEvents] = useState([]);\n  const [showCalendar, setShowCalendar] = useState(false);\n  const [eventDetails, setEventDetails] = useState({});\n  const [selectedSlots, setSelectedSlots] = useState([]);\n  // Add cache for events data\n  const [eventsCache, setEventsCache] = useState({});\n  const [fetchingEvents, setFetchingEvents] = useState(false);\n  \n  // Chat-specific state\n  const [chatMessages, setChatMessages] = useState([]);\n  const [showSettings, setShowSettings] = useState(false);\n  \n  // Recommendation system state\n  const [suggestions, setSuggestions] = useState([]);\n  const [showRecommendations, setShowRecommendations] = useState(false);\n  \n  // Call the setup function on load\n  useEffect(() => {\n    setupGlobalFunctions();\n    // Add welcome message\n    setChatMessages([{ sender: 'bot', type: 'welcome' }]);\n    \n    // Load saved popular commands from localStorage\n    loadPopularCommands();\n  }, []);\n  \n  const [calendars, setCalendars] = useState([]);\n  const [selectedCalendars, setSelectedCalendars] = useState([]);\n  const [dateRange, setDateRange] = useState({\n    start: new Date(),\n    end: new Date(new Date().setDate(new Date().getDate() + 7))\n  });\n\n  // Helper function to format date to YYYY-MM-DD\n  const formatDate = (date) => {\n    const d = new Date(date);\n    let month = '' + (d.getMonth() + 1);\n    let day = '' + d.getDate();\n    const year = d.getFullYear();\n\n    if (month.length < 2) month = '0' + month;\n    if (day.length < 2) day = '0' + day;\n\n    return [year, month, day].join('-');\n  };\n\n  // Helper function to get color for a specific calendar\n  const getCalendarColor = (calendarId, darker = false) => {\n    // Find the calendar in our list\n    const calendar = calendars.find(cal => cal.id === calendarId);\n    if (calendar && calendar.backgroundColor) {\n      // Enhance color vibrancy by ensuring full opacity\n      let color = calendar.backgroundColor;\n      \n      // If it's an RGBA color, convert to fully opaque\n      if (color.startsWith('rgba')) {\n        const rgbaPattern = /rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*[\\d.]+\\s*\\)/;\n        const match = color.match(rgbaPattern);\n        if (match) {\n          color = `rgb(${match[1]}, ${match[2]}, ${match[3]})`;\n        }\n      }\n      \n      if (darker) {\n        // Create a slightly darker version for the border\n        return darkenColor(color, 0.2);\n      }\n      return color;\n    }\n    // Default color if calendar not found - using a more vibrant blue\n    return darker ? '#1565C0' : '#1E88E5';\n  };\n\n  // Helper function to darken a color\n  const darkenColor = (color, amount) => {\n    try {\n      // Handle RGB format\n      if (color.startsWith('rgb')) {\n        const rgbPattern = /rgb\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)/;\n        const match = color.match(rgbPattern);\n        if (match) {\n          let r = parseInt(match[1], 10);\n          let g = parseInt(match[2], 10);\n          let b = parseInt(match[3], 10);\n          \n          r = Math.max(0, Math.floor(r * (1 - amount)));\n          g = Math.max(0, Math.floor(g * (1 - amount)));\n          b = Math.max(0, Math.floor(b * (1 - amount)));\n          \n          return `rgb(${r}, ${g}, ${b})`;\n        }\n      }\n      \n      // Remove the hash if it exists for hex colors\n      color = color.replace('#', '');\n      \n      // Parse the color\n      let r = parseInt(color.substring(0, 2), 16);\n      let g = parseInt(color.substring(2, 4), 16);\n      let b = parseInt(color.substring(4, 6), 16);\n      \n      // Darken the color\n      r = Math.max(0, Math.floor(r * (1 - amount)));\n      g = Math.max(0, Math.floor(g * (1 - amount)));\n      b = Math.max(0, Math.floor(b * (1 - amount)));\n      \n      // Convert back to hex\n      return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;\n    } catch (e) {\n      console.error('Error darkening color:', e);\n      return color; // Return original color if there's an error\n    }\n  };\n\n  // Define fetchExistingEvents before it's used in the event listener\n  const fetchExistingEvents = useCallback(async (forceRefresh = false) => {\n    // Prevent multiple simultaneous requests\n    if (fetchingEvents) return;\n    \n    try {\n      setFetchingEvents(true);\n      const startDate = formatDate(dateRange.start);\n      const endDate = formatDate(dateRange.end);\n      \n      // Skip logging in production\n      if (process.env.NODE_ENV !== 'production') {\n        console.log(\"Fetching events from:\", startDate, \"to\", endDate);\n      }\n      \n      // Create the calendar IDs parameter\n      const calendarIds = selectedCalendars.map(cal => cal.id).join(',');\n      \n      // Create a cache key based on date range and selected calendars\n      const cacheKey = `${startDate}_${endDate}_${calendarIds}`;\n      \n      // Check if we have cached data and not forcing refresh\n      if (!forceRefresh && eventsCache[cacheKey] && eventsCache[cacheKey].expiry > Date.now()) {\n        setExistingEvents(eventsCache[cacheKey].data);\n        setFetchingEvents(false);\n        return;\n      }\n      \n      // Add retry logic\n      let retries = 0;\n      const maxRetries = 3;\n      let response;\n      \n      while (retries < maxRetries) {\n        try {\n          response = await axios.get(\n            `http://127.0.0.1:5000/api/get-events?start=${startDate}&end=${endDate}&calendars=${calendarIds}`\n          );\n          break; // Success, exit retry loop\n        } catch (err) {\n          const currentRetry = retries; // Capture current value to avoid the loop reference issue\n          retries++;\n          if (currentRetry === maxRetries - 1) throw err;\n          // Wait before retrying (exponential backoff)\n          await new Promise(resolve => setTimeout(resolve, 1000 * Math.pow(2, currentRetry + 1)));\n        }\n      }\n      \n      if (response.data.success) {\n        // Check if there are any events in the response\n        let events = response.data.events || [];\n        \n        // If no events are returned and we're in development mode, add some mock events for testing\n        if (events.length === 0 && process.env.NODE_ENV === 'development') {\n          console.log(\"No events returned from API, adding mock events for testing\");\n          // Create a few mock events for the current week\n          const now = new Date();\n          const tomorrow = new Date(now);\n          tomorrow.setDate(tomorrow.getDate() + 1);\n          \n          events = [\n            {\n              id: 'mock-1',\n              title: 'Team Meeting',\n              start: new Date(now.getFullYear(), now.getMonth(), now.getDate(), 10, 0).toISOString(),\n              end: new Date(now.getFullYear(), now.getMonth(), now.getDate(), 11, 0).toISOString(),\n              calendarId: 'primary',\n              calendarName: 'Primary Calendar'\n            },\n            {\n              id: 'mock-2',\n              title: 'Lunch Break',\n              start: new Date(now.getFullYear(), now.getMonth(), now.getDate(), 12, 0).toISOString(),\n              end: new Date(now.getFullYear(), now.getMonth(), now.getDate(), 13, 0).toISOString(),\n              calendarId: 'primary',\n              calendarName: 'Primary Calendar'\n            },\n            {\n              id: 'mock-3',\n              title: 'Project Review',\n              start: new Date(tomorrow.getFullYear(), tomorrow.getMonth(), tomorrow.getDate(), 14, 0).toISOString(),\n              end: new Date(tomorrow.getFullYear(), tomorrow.getMonth(), tomorrow.getDate(), 15, 30).toISOString(),\n              calendarId: 'work',\n              calendarName: 'Work Calendar'\n            }\n          ];\n        }\n        \n        if (events.length > 0) {\n          // Process all events at once with minimal logging\n          const eventsWithMetadata = events.map(event => ({\n            ...event,\n            title: event.title || event.summary || \"Untitled Event\",\n            existingEvent: true,\n            backgroundColor: event.backgroundColor || getCalendarColor(event.calendarId),\n            borderColor: event.borderColor || getCalendarColor(event.calendarId, true),\n            textColor: event.textColor || '#ffffff',\n            classNames: ['calendar-event']  // Add a class for additional styling\n          }));\n          \n          // Update the cache with a 5-minute expiration\n          setEventsCache(prev => ({\n            ...prev,\n            [cacheKey]: {\n              data: eventsWithMetadata,\n              expiry: Date.now() + 5 * 60 * 1000 // 5 minutes\n            }\n          }));\n          \n          setExistingEvents(eventsWithMetadata);\n        } else {\n          setExistingEvents([]);\n        }\n      } else {\n        console.error('Error fetching events:', response.data.message);\n      }\n    } catch (error) {\n      console.error('Error fetching events:', error);\n      setError('Failed to load events. Please try again.');\n    } finally {\n      setFetchingEvents(false);\n    }\n  }, [dateRange, formatDate, getCalendarColor, selectedCalendars, eventsCache, fetchingEvents, setError]);\n\n  // Recommendation system functions\n  const loadPopularCommands = () => {\n    try {\n      const savedCommands = localStorage.getItem('popularCommands');\n      if (savedCommands) {\n        const commands = JSON.parse(savedCommands);\n        // Get top 5 most used commands\n        const topCommands = commands\n          .sort((a, b) => b.count - a.count)\n          .slice(0, 5);\n          \n        if (topCommands.length > 0) {\n          // Format commands with icons and colors\n          const formattedCommands = topCommands.map((cmd, index) => {\n            // Detect command type to assign appropriate icon and color\n            let icon = ICONS.SCHEDULE;\n            let color = COLORS.BLUE;\n            \n            const lowerText = cmd.text.toLowerCase();\n            \n            if (lowerText.includes('free time') || lowerText.includes('availability')) {\n              icon = ICONS.FREE_TIME;\n              color = COLORS.GREEN;\n            } else if (lowerText.includes('meeting') || lowerText.includes('have') || lowerText.includes('scheduled')) {\n              icon = ICONS.MEETINGS;\n              color = COLORS.PURPLE;\n            } else if (lowerText.includes('break') || lowerText.includes('rest')) {\n              icon = ICONS.BREAK;\n              color = COLORS.ORANGE;\n            } else if (lowerText.includes('assignment') || lowerText.includes('work on')) {\n              icon = ICONS.ASSIGNMENT;\n              color = COLORS.RED;\n            } else if (lowerText.includes('remind') || lowerText.includes('notification')) {\n              icon = ICONS.REMINDER;\n              color = COLORS.ORANGE;\n            }\n            \n            return {\n              text: cmd.text,\n              count: cmd.count,\n              icon,\n              color\n            };\n          });\n          \n          setSuggestions(formattedCommands);\n          setShowRecommendations(true);\n        } else {\n          setSuggestions(DEFAULT_SUGGESTIONS);\n          setShowRecommendations(true);\n        }\n      } else {\n        // No saved commands, use defaults\n        setSuggestions(DEFAULT_SUGGESTIONS);\n        setShowRecommendations(true);\n      }\n    } catch (error) {\n      console.error('Error loading popular commands:', error);\n      setSuggestions(DEFAULT_SUGGESTIONS);\n      setShowRecommendations(true);\n    }\n  };\n  \n  const trackCommand = (commandText) => {\n    try {\n      // Skip tracking empty commands\n      if (!commandText.trim()) return;\n      \n      // Get existing commands or initialize empty array\n      const existingCommands = JSON.parse(localStorage.getItem('popularCommands') || '[]');\n      \n      // Check if this command already exists\n      const existingIndex = existingCommands.findIndex(\n        cmd => cmd.text.toLowerCase() === commandText.toLowerCase()\n      );\n      \n      if (existingIndex >= 0) {\n        // Increment count for existing command\n        existingCommands[existingIndex].count += 1;\n        existingCommands[existingIndex].lastUsed = new Date().toISOString();\n      } else {\n        // Add new command\n        existingCommands.push({\n          text: commandText,\n          count: 1,\n          lastUsed: new Date().toISOString()\n        });\n      }\n      \n      // Save back to localStorage\n      localStorage.setItem('popularCommands', JSON.stringify(existingCommands));\n      \n      // Update suggestions\n      loadPopularCommands();\n    } catch (error) {\n      console.error('Error tracking command:', error);\n    }\n  };\n  \n  const handleSelectSuggestion = (suggestion) => {\n    setText(suggestion);\n    // Focus the input field\n    document.querySelector('.chat-input textarea').focus();\n  };\n\n  const handleSubmit = useCallback(async (e) => {\n    e.preventDefault();\n    console.log(\"handleSubmit called with text:\", text);\n    if (!text.trim()) return;\n\n    // Track the command for the recommendation system\n    trackCommand(text);\n\n    // Add user message to chat\n    setChatMessages(prev => [...prev, { sender: 'user', content: text }]);\n    \n    setLoading(true);\n    setError(\"\");\n    setMessage(\"\");\n    setAvailableSlots([]);\n    setCalendarEvents([]);\n    setSelectedSlots([]);\n\n    try {\n      console.log(\"Making API call with text:\", text);\n      const response = await axios.post('http://127.0.0.1:5000/api/natural-language-event', {\n        text\n      });\n      console.log(\"API response:\", response.data);\n\n      if (response.data.success) {\n        // Handle the response in chat format\n        if (response.data.humanizedResponse) {\n          if (response.data.intent === \"check_free_time\") {\n            // For check_free_time intent with HTML\n            setChatMessages(prev => [...prev, { \n              sender: 'bot', \n              content: response.data.humanizedResponse \n            }]);\n            setText(\"\");\n          } else {\n            // For other intents with text response\n            setChatMessages(prev => [...prev, { \n              sender: 'bot', \n              content: response.data.humanizedResponse \n            }]);\n          }\n        }\n        \n        if (response.data.intent === \"find_time\") {\n          setAvailableSlots(response.data.availableSlots);\n          setCalendarEvents(response.data.events || []);\n          setShowCalendar(true);\n          \n          // Check if we have the insufficientTime flag\n          if (response.data.insufficientTime) {\n            // Add error message to chat\n            setChatMessages(prev => [...prev, { \n              sender: 'bot', \n              type: 'error',\n              content: `INSUFFICIENT TIME: ${response.data.humanizedResponse || response.data.message} Select these slots or try a different timeframe.` \n            }]);\n          } else if (!response.data.humanizedResponse) {\n            // Only set this default message if humanizedResponse wasn't already set\n            setChatMessages(prev => [...prev, { \n              sender: 'bot', \n              content: \"Here are suggested time slots on your calendar. Click on slots to select/deselect them for scheduling.\" \n            }]);\n          }\n          \n          setEventDetails({\n            summary: response.data.calendar_title || getEventSummaryFromText(text),\n            description: text,\n            calendarId: response.data.predicted_calendar || \"primary\"\n          });\n        } else if (response.data.intent === \"view_events\") {\n          // Just display the humanized response for view_events, no calendar needed\n          setText(\"\");\n        } else if (response.data.intent === \"Create event\" && !response.data.humanizedResponse) {\n          // Fallback for create event if no humanizedResponse is available\n          setChatMessages(prev => [...prev, { \n            sender: 'bot', \n            type: 'success',\n            content: `Event created! ${response.data.eventLink ? `View it here: ${response.data.eventLink}` : ''}` \n          }]);\n          setText(\"\");\n        } else {\n          // For other intents or if we already set humanizedResponse\n          setText(\"\");\n        }\n      } else {\n        // Add error message to chat\n        setChatMessages(prev => [...prev, { \n          sender: 'bot', \n          type: 'error',\n          content: `Error: ${response.data.humanizedResponse || response.data.message}` \n        }]);\n      }\n    } catch (error) {\n      // Add error message to chat\n      setChatMessages(prev => [...prev, { \n        sender: 'bot', \n        type: 'error',\n        content: `Error: ${error.response?.data?.message || error.message}` \n      }]);\n    } finally {\n      setLoading(false);\n    }\n  }, [text, setLoading, setText, setChatMessages, setAvailableSlots, setCalendarEvents, setSelectedSlots, setShowCalendar, setEventDetails]);\n\n  // Event handler for scheduling items - using useCallback to avoid dependency issues\n  const handleScheduleItem = useCallback((event) => {\n    console.log(\"Custom event received:\", event.detail);\n    const { type, startTime, endTime } = event.detail;\n    const startDate = new Date();\n    const formattedDate = startDate.toLocaleDateString('en-US', { \n      month: 'long', \n      day: 'numeric',\n      year: 'numeric'\n    });\n    \n    if (type === 'break') {\n      const newText = `Schedule a break on ${formattedDate} from ${startTime} to ${endTime}`;\n      console.log(\"Setting text for break:\", newText);\n      setText(newText);\n      // Submit after React has updated the state\n      setTimeout(() => {\n        handleSubmit({ preventDefault: () => {} });\n      }, 50);\n    } else if (type === 'task') {\n      // Show prompt for task name\n      const taskName = prompt(\"What would you like to name this task?\", \"Work Session\");\n      if (taskName) {\n        const newText = `Schedule ${taskName} on ${formattedDate} from ${startTime} to ${endTime}`;\n        console.log(\"Setting text for task:\", newText);\n        setText(newText);\n        // Submit after React has updated the state\n        setTimeout(() => {\n          handleSubmit({ preventDefault: () => {} });\n        }, 50);\n      }\n    }\n  }, [setText, handleSubmit]);\n  \n  // Set up event listeners\n  useEffect(() => {\n    window.addEventListener('scheduleCalendarItem', handleScheduleItem);\n    \n    // Add event listener for refreshCalendar event\n    const handleRefreshCalendar = () => {\n      if (showCalendar) {\n        console.log(\"Refreshing calendar events via refreshCalendar event\");\n        fetchExistingEvents();\n      }\n    };\n    \n    window.addEventListener('refreshCalendar', handleRefreshCalendar);\n    \n    // Clean up event listeners\n    return () => {\n      window.removeEventListener('scheduleCalendarItem', handleScheduleItem);\n      window.removeEventListener('refreshCalendar', handleRefreshCalendar);\n    };\n  }, [handleScheduleItem, fetchExistingEvents, showCalendar]);\n\n  // Fetch existing events when calendar is shown or date range changes\n  useEffect(() => {\n    if (showCalendar) {\n      console.log(\"Fetching existing events because calendar is shown or date range changed\");\n      fetchExistingEvents();\n    }\n  }, [showCalendar, dateRange, fetchExistingEvents]);\n\n  // Fetch all calendars and current preferences on mount\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        // Use Promise.all to fetch calendars and preferences in parallel\n        const [calendarsResponse, prefsResponse] = await Promise.all([\n          axios.get('http://127.0.0.1:5000/api/get-calendars'),\n          axios.get('http://127.0.0.1:5000/api/get-preferred-calendars')\n        ]);\n        \n        if (!calendarsResponse.data.success) {\n          throw new Error(`Failed to fetch calendars: ${calendarsResponse.data.message || 'Unknown error'}`);\n        }\n        \n        if (!prefsResponse.data.success) {\n          throw new Error(`Failed to fetch preferred calendars: ${prefsResponse.data.message || 'Unknown error'}`);\n        }\n        \n        const allCalendars = calendarsResponse.data.calendars;\n        const preferredCals = prefsResponse.data.calendars;\n\n        // Update state all at once to avoid multiple re-renders\n        if (preferredCals.length > 0) {\n          // Ensure the saved preferences match the full calendar data\n          const syncedPrefs = preferredCals.map(pref => \n            allCalendars.find(cal => cal.id === pref.id) || pref\n          );\n          setCalendars(allCalendars);\n          setSelectedCalendars(syncedPrefs);\n        } else {\n          const primaryCal = allCalendars.find(cal => cal.primary);\n          setCalendars(allCalendars);\n          if (primaryCal) {\n            setSelectedCalendars([primaryCal]);\n          }\n        }\n      } catch (error) {\n        console.error('Error fetching data:', error);\n        setError(`Error loading calendars or preferences: ${error.message}`);\n      }\n    };\n    fetchData();\n  }, []);\n\n  // Send preferences to backend only when user changes them\n  useEffect(() => {\n    if (selectedCalendars.length > 0) {\n      const sendPreferences = async () => {\n        try {\n          // Debounce the API call to avoid excessive requests\n          const timeoutId = setTimeout(async () => {\n            const response = await axios.post('http://127.0.0.1:5000/api/set-preferred-calendars', {\n              calendars: selectedCalendars\n            });\n            if (!response.data.success) {\n              throw new Error(response.data.message);\n            }\n          }, 500); // Wait 500ms before sending the request\n          \n          // Clear the timeout if the effect runs again before it fires\n          return () => clearTimeout(timeoutId);\n        } catch (error) {\n          console.error('Error setting preferred calendars:', error);\n          setError('Error saving calendar preferences.');\n        }\n      };\n      sendPreferences();\n    }\n  }, [selectedCalendars]);\n\n  const handleCalendarSelect = useCallback((cal) => {\n    setSelectedCalendars((prev) => {\n      // Check if we're adding or removing a calendar\n      const isRemovingCalendar = prev.some((selected) => selected.id === cal.id);\n      const newCalendars = isRemovingCalendar\n        ? prev.filter((selected) => selected.id !== cal.id)\n        : [...prev, cal];\n        \n      // Clear events cache when calendars change\n      setEventsCache({});\n      return newCalendars;\n    });\n  }, [setEventsCache]);\n\n  const getEventSummaryFromText = (text) => {\n    const firstSentence = text.split('.')[0];\n    if (firstSentence.length <= 50) return firstSentence;\n    return firstSentence.substring(0, 50) + '...';\n  };\n\n  const handleEventClick = (info) => {\n    const { event } = info;\n    \n    // Only handle suggested slots\n    if (event.extendedProps.suggestedSlot) {\n      const eventData = {\n        start: event.start.toISOString(),\n        end: event.end.toISOString()\n      };\n      \n      // Toggle selection\n      setSelectedSlots(prev => {\n        const isAlreadySelected = prev.some(slot => \n          slot.start === eventData.start && slot.end === eventData.end\n        );\n        \n        if (isAlreadySelected) {\n          // Remove from selection\n          return prev.filter(slot => \n            !(slot.start === eventData.start && slot.end === eventData.end)\n          );\n        } else {\n          // Add to selection\n          return [...prev, eventData];\n        }\n      });\n      \n      // Update event color based on selection\n      const isSelected = !selectedSlots.some(slot => \n        slot.start === eventData.start && slot.end === eventData.end\n      );\n      \n      if (isSelected) {\n        event.setProp('backgroundColor', '#4caf50');\n        event.setProp('borderColor', '#2e7d32');\n        event.setProp('title', 'Selected Time');\n      } else {\n        event.setProp('backgroundColor', '#8bc34a');\n        event.setProp('borderColor', '#689f38');\n        event.setProp('title', 'Suggested Time');\n      }\n    } else {\n      // For existing events, show some details in a tooltip or alert\n      const eventTitle = event.title;\n      const eventTime = `${event.start.toLocaleTimeString()} - ${event.end.toLocaleTimeString()}`;\n      const calendarName = event.extendedProps.calendarName || 'Unknown Calendar';\n      \n      // Simple alert for demonstration - in a real app, you might want a tooltip or modal\n      alert(`Event: ${eventTitle}\\nTime: ${eventTime}\\nCalendar: ${calendarName}`);\n    }\n  };\n\n  const calculateTotalHours = () => {\n    let totalMinutes = 0;\n    selectedSlots.forEach(slot => {\n      const start = new Date(slot.start);\n      const end = new Date(slot.end);\n      const diffMinutes = (end - start) / (1000 * 60);\n      totalMinutes += diffMinutes;\n    });\n    const hours = Math.floor(totalMinutes / 60);\n    const minutes = Math.floor(totalMinutes % 60);\n    return `${hours}h ${minutes}m`;\n  };\n\n  const handleScheduleSelected = async () => {\n    if (selectedSlots.length === 0) return;\n\n    setLoading(true);\n    try {\n      // Create multiple events, one for each selected slot\n      const promises = selectedSlots.map(slot => {\n        return axios.post('http://127.0.0.1:5000/api/schedule-selected-slot', {\n          selectedSlot: slot,\n          eventDetails\n        });\n      });\n      \n      const results = await Promise.all(promises);\n      const allSuccessful = results.every(r => r.data.success);\n      \n      if (allSuccessful) {\n        // Add success message to chat\n        setChatMessages(prev => [...prev, { \n          sender: 'bot', \n          type: 'success',\n          content: `All ${selectedSlots.length} events scheduled successfully!` \n        }]);\n        \n        setText(\"\");\n        setShowCalendar(false);\n        setAvailableSlots([]);\n        setCalendarEvents([]);\n        setSelectedSlots([]);\n      } else {\n        // Add error message to chat\n        setChatMessages(prev => [...prev, { \n          sender: 'bot', \n          type: 'error',\n          content: `Error: Some events could not be scheduled.` \n        }]);\n      }\n    } catch (error) {\n      // Add error message to chat\n      setChatMessages(prev => [...prev, { \n        sender: 'bot', \n        type: 'error',\n        content: `Error: ${error.response?.data?.message || error.message}` \n      }]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleFindDifferentTimes = () => {\n    // Add message to chat\n    setChatMessages(prev => [...prev, { \n      sender: 'bot', \n      content: \"Let's find another time. Please provide more details:\"\n    }]);\n    \n    setShowCalendar(false);\n    setAvailableSlots([]);\n    setCalendarEvents([]);\n    setSelectedSlots([]);\n  };\n  \n  const handleDatesSet = (dateInfo) => {\n    console.log(\"Calendar dates changed:\", dateInfo.startStr, \"to\", dateInfo.endStr);\n    setDateRange({\n      start: dateInfo.start,\n      end: dateInfo.end\n    });\n    \n    // If calendar is currently showing, fetch events for the new date range\n    if (showCalendar) {\n      console.log(\"Fetching events for new date range\");\n      fetchExistingEvents();\n    }\n  };\n  \n  // Optimize to avoid recalculation on each render\n  const getAllEvents = useCallback(() => {\n    // Start with existing events\n    const allEvents = [...existingEvents];\n    \n    // Add suggested slots with updated colors based on selection\n    if (calendarEvents.length > 0) {\n      calendarEvents.forEach(event => {\n        const isSelected = selectedSlots.some(slot => \n          slot.start === event.start && slot.end === event.end\n        );\n        \n        allEvents.push({\n          ...event,\n          backgroundColor: isSelected ? '#4caf50' : '#8bc34a',\n          borderColor: isSelected ? '#2e7d32' : '#689f38',\n          textColor: '#ffffff',\n          title: isSelected ? 'Selected Time' : 'Suggested Time',\n          display: 'block',\n          extendedProps: {\n            ...event.extendedProps,\n            suggestedSlot: true\n          }\n        });\n      });\n    }\n    \n    return allEvents;\n  }, [existingEvents, calendarEvents, selectedSlots]);\n\n  // Precalculate events to avoid useMemo in render\n  const currentEvents = getAllEvents();\n\n  // Render calendar in a chat message\n  const renderCalendarMessage = () => {\n    if (!showCalendar) return null;\n    \n    const currentEvents = getAllEvents();\n    \n    return (\n      <ChatMessage sender=\"bot\" isCalendarView={true} className=\"calendar-message\">\n        <div className=\"calendar-view w-full\">\n          {selectedSlots.length > 0 && (\n            <div className=\"bg-blue-50 border border-blue-100 rounded-lg p-4 mb-4 text-blue-800 font-medium\">\n              <p>Selected {selectedSlots.length} slot(s) - Total time: {calculateTotalHours()}</p>\n            </div>\n          )}\n          <div className=\"calendar-legend\">\n            {/* Legend for suggested/selected slots */}\n            <div className=\"legend-section\">\n              <div className=\"legend-item\">\n                <span className=\"legend-color suggested-event-color\"></span>\n                <span>Suggested Work Slots</span>\n              </div>\n              <div className=\"legend-item\">\n                <span className=\"legend-color selected-event-color\"></span>\n                <span>Selected Work Slots</span>\n              </div>\n            </div>\n            \n            {/* Legend for calendars */}\n            <div className=\"legend-section\">\n              <div className=\"legend-title\">Your Calendars:</div>\n              {selectedCalendars.map(cal => (\n                <div className=\"legend-item\" key={cal.id}>\n                  <span \n                    className=\"legend-color\" \n                    style={{ \n                      backgroundColor: cal.backgroundColor || getCalendarColor(cal.id),\n                      border: `1px solid ${cal.borderColor || getCalendarColor(cal.id, true)}`\n                    }}\n                  ></span>\n                  <span>{cal.summary}</span>\n                </div>\n              ))}\n            </div>\n          </div>\n          \n          {/* Use the memoized calendar component with precalculated events */}\n          <CalendarComponent \n            events={currentEvents}\n            handleEventClick={handleEventClick}\n            handleDatesSet={handleDatesSet}\n            loading={loading || fetchingEvents} \n            renderEventContent={renderEventContent}\n          />\n          \n          <div className=\"flex mt-6 space-x-4\">\n            <button\n              onClick={handleScheduleSelected}\n              disabled={selectedSlots.length === 0 || loading}\n              className={`\n                px-6 py-3 rounded-lg font-medium flex items-center justify-center\n                ${selectedSlots.length === 0 || loading \n                  ? 'bg-gray-300 cursor-not-allowed text-gray-500' \n                  : 'bg-green-600 hover:bg-green-700 text-white shadow-md hover:shadow-lg transition-all duration-200'}\n              `}\n            >\n              {loading ? (\n                <div className=\"flex items-center\">\n                  <svg className=\"animate-spin -ml-1 mr-2 h-5 w-5\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n                    <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n                    <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n                  </svg>\n                  Scheduling...\n                </div>\n              ) : `Schedule ${selectedSlots.length} Selected Time${selectedSlots.length === 1 ? '' : 's'}`}\n            </button>\n            <button\n              onClick={handleFindDifferentTimes}\n              disabled={loading}\n              className=\"px-6 py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium shadow-md hover:shadow-lg transition-all duration-200\"\n            >\n              Find Different Times\n            </button>\n          </div>\n        </div>\n      </ChatMessage>\n    );\n  };\n\n  // Format events in a user-friendly way\n  const formatStyledEventList = (responseText) => {\n    console.log(\"Formatting response:\", responseText); // Debug to see what's being processed\n    \n    // First, check for specific format with Cmpt 310 or other course names\n    if (responseText.includes(\"Cmpt 310\") || responseText.includes(\"CMPT 310\")) {\n      try {\n        // Extract date more flexibly\n        let dateMatch = responseText.match(/for\\s+([A-Za-z]+\\s+\\d+(?:st|nd|rd|th)?,\\s+\\d{4})/i);\n        const dateStr = dateMatch ? dateMatch[1] : \"Today\";\n        \n        // Simpler regex to match formatted times and course info\n        const eventPattern = /\\*\\*([^*]+)\\*\\*:\\s*([^*\\n]+?)(?:\\sin\\s+([^*\\n]*))?(?=\\s*\\*\\*|\\s*$)/g;\n        let match;\n        const events = [];\n        \n        while ((match = eventPattern.exec(responseText)) !== null) {\n          console.log(\"Matched event:\", match); // Debug\n          const timeRange = match[1].trim();\n          const title = match[2].trim();\n          const location = match[3] ? match[3].trim() : '';\n          \n          events.push({\n            timeRange,\n            title,\n            location,\n            duration: calculateDuration(timeRange)\n          });\n        }\n        \n        // If we couldn't extract events with the regex, try a direct approach for the specific format\n        if (events.length === 0 && responseText.includes(\"AM\") && responseText.includes(\"PM\")) {\n          // Direct parsing for the specific format in the image\n          const timeMatch = responseText.match(/(\\d+:\\d+\\s*(?:AM|PM)\\s*-\\s*\\d+:\\d+\\s*(?:AM|PM))/i);\n          const courseMatch = responseText.match(/Cmpt\\s+\\d+|CMPT\\s+\\d+/i);\n          const locationMatch = responseText.match(/at\\s+([A-Z]+\\s+\\d+)/i);\n          \n          if (timeMatch && courseMatch) {\n            events.push({\n              timeRange: timeMatch[1].trim(),\n              title: courseMatch[0].trim() + (responseText.includes(\"OH\") ? \" Office Hours\" : \"\"),\n              location: locationMatch ? locationMatch[1].trim() : \"\",\n              duration: calculateDuration(timeMatch[1].trim())\n            });\n            console.log(\"Direct parse event:\", events[0]); // Debug\n          }\n        }\n        \n        // If we extracted events, format them nicely\n        if (events.length > 0) {\n          // Generate intro text\n          const introMatch = responseText.match(/^([^*]+)/);\n          const introText = introMatch ? introMatch[0].trim() : `Here's your schedule for ${dateStr}:`;\n          \n          return generateEventHTML(introText, dateStr, events);\n        }\n      } catch (error) {\n        console.error(\"Error formatting events:\", error);\n      }\n    }\n    \n    // Check if this is a schedule/calendar response with events\n    if ((responseText.includes(\"schedule\") || responseText.includes(\"calendar\") || \n         responseText.includes(\"looks like for\") || responseText.includes(\"have\") || \n         responseText.includes(\"Monday\") || responseText.includes(\"monday\")) && \n        (responseText.includes(\"**\") || responseText.includes(\"AM\") || responseText.includes(\"PM\"))) {\n      try {\n        // Extract date\n        let dateMatch = responseText.match(/(?:for|on)\\s+([A-Za-z]+\\s+\\d+(?:st|nd|rd|th)?,\\s+\\d{4})/i);\n        const dateStr = dateMatch ? dateMatch[1] : \n                       (responseText.toLowerCase().includes(\"monday\") ? \"Monday\" : \"Today\");\n        \n        // Parse events from the text - improved regex pattern to better capture events\n        const eventPattern = /\\*\\*([0-9:.APM\\s-]+)\\*\\*:\\s*([^*\\n]+?)(?:\\sin\\s+([^*\\n]*))?(?=\\s*\\*\\*|\\s*$)/g;\n        let match;\n        const events = [];\n        \n        while ((match = eventPattern.exec(responseText)) !== null) {\n          const timeRange = match[1].trim();\n          const title = match[2].trim();\n          const location = match[3] ? match[3].trim() : '';\n          \n          events.push({\n            timeRange,\n            title,\n            location,\n            duration: calculateDuration(timeRange)\n          });\n        }\n        \n        // Try alternative pattern if no events found\n        if (events.length === 0) {\n          const altPattern = /(\\d+(?::\\d+)?\\s*(?:AM|PM)\\s*-\\s*\\d+(?::\\d+)?\\s*(?:AM|PM))[\\s:]*([^()\\n,]+)(?:\\s+in\\s+([^()\\n,]+))?/gi;\n          while ((match = altPattern.exec(responseText)) !== null) {\n            events.push({\n              timeRange: match[1].trim(),\n              title: match[2].trim(),\n              location: match[3] ? match[3].trim() : '',\n              duration: calculateDuration(match[1].trim())\n            });\n          }\n        }\n        \n        // If we extracted events, format them nicely\n        if (events.length > 0) {\n          // Generate intro text\n          const introMatch = responseText.match(/^([^*]+)/);\n          const introText = introMatch ? introMatch[0].trim() : `Here's your schedule for ${dateStr}:`;\n          \n          return generateEventHTML(introText, dateStr, events);\n        } else {\n          // If we still couldn't find events, fall back to default formatting\n          return defaultStyledFormat(responseText);\n        }\n      } catch (error) {\n        console.error(\"Error formatting events:\", error);\n        return defaultStyledFormat(responseText);\n      }\n    }\n    \n    // For regular text responses, make them more visually interesting\n    if (!responseText.includes(\"<div\") && !responseText.includes(\"<p\") && !responseText.includes(\"<ul\")) {\n      // If it mentions free time, use a special format\n      if (responseText.toLowerCase().includes(\"free time\") || \n          responseText.toLowerCase().includes(\"available\") || \n          responseText.toLowerCase().includes(\"time slot\")) {\n        return generateFreeTimeHTML(responseText);\n      }\n      \n      // If it's a confirmation or completion message\n      if (responseText.toLowerCase().includes(\"scheduled\") || \n          responseText.toLowerCase().includes(\"created\") || \n          responseText.toLowerCase().includes(\"added\")) {\n        return generateConfirmationHTML(responseText);\n      }\n      \n      // Default enhanced format for other responses\n      return defaultStyledFormat(responseText);\n    }\n    \n    // Return original if no formatting applied\n    return responseText;\n  };\n  \n  // Helper function to calculate duration from a time range\n  const calculateDuration = (timeRange) => {\n    if (!timeRange || !timeRange.includes(\"-\")) return \"\";\n    \n    try {\n      const [startTime, endTime] = timeRange.split(\"-\").map(t => t.trim());\n      \n      const parseTime = (timeStr) => {\n        const [time, modifier] = timeStr.split(/\\s+/);\n        let [hours, minutes] = (time || \"\").split(':').map(Number);\n        minutes = minutes || 0;\n        if (modifier && modifier.toUpperCase() === 'PM' && hours < 12) hours += 12;\n        if (modifier && modifier.toUpperCase() === 'AM' && hours === 12) hours = 0;\n        return hours * 60 + minutes;\n      };\n      \n      const startMinutes = parseTime(startTime);\n      const endMinutes = parseTime(endTime);\n      const durationMinutes = endMinutes - startMinutes;\n      \n      if (durationMinutes > 0) {\n        const hours = Math.floor(durationMinutes / 60);\n        const mins = durationMinutes % 60;\n        return hours > 0 \n          ? `${hours} hour${hours > 1 ? 's' : ''}${mins > 0 ? ` ${mins} min` : ''}` \n          : `${mins} min`;\n      }\n      return \"\";\n    } catch (e) {\n      console.error(\"Error calculating duration:\", e);\n      return \"\";\n    }\n  };\n  \n  // Helper function to generate HTML for events\n  const generateEventHTML = (introText, dateStr, events) => {\n    return `\n      <div>\n        <p>${introText}</p>\n        <div class=\"styled-event-list\">\n          <div class=\"event-date\">${dateStr}</div>\n          ${events.map(event => {\n            // Determine background color based on event title (for courses)\n            let bgColor = '#e5edff'; // default blue background\n            let iconColor = '#3b82f6'; // default blue icon\n            \n            if (event.title.includes('CMPT 310') || event.title.includes('Cmpt 310')) {\n              bgColor = '#f3e8ff'; // purple for CMPT 310\n              iconColor = '#8b5cf6';\n            } else if (event.title.includes('CMPT 213') || event.title.includes('Cmpt 213')) {\n              bgColor = '#e0f2fe'; // light blue for CMPT 213\n              iconColor = '#0ea5e9';\n            } else if (event.title.includes('CMPT 276') || event.title.includes('Cmpt 276')) {\n              bgColor = '#dcfce7'; // green for CMPT 276\n              iconColor = '#22c55e';\n            } else if (event.title.includes('CMPT 105W') || event.title.includes('Cmpt 105W')) {\n              bgColor = '#ffedd5'; // orange for CMPT 105W\n              iconColor = '#f97316';\n            } else if (event.title.includes('OH') || event.title.includes('Office Hours')) {\n              bgColor = '#ffe4e6'; // pink for Office Hours\n              iconColor = '#e11d48';\n            }\n            \n            return `\n            <div class=\"event-item\">\n              <div class=\"event-item-icon\" style=\"background-color: ${bgColor}; color: ${iconColor};\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                  <rect x=\"3\" y=\"4\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\n                  <line x1=\"16\" y1=\"2\" x2=\"16\" y2=\"6\"></line>\n                  <line x1=\"8\" y1=\"2\" x2=\"8\" y2=\"6\"></line>\n                  <line x1=\"3\" y1=\"10\" x2=\"21\" y2=\"10\"></line>\n                </svg>\n              </div>\n              <div>\n                <div class=\"event-time\">${event.timeRange}</div>\n                <div class=\"event-content\">\n                  <div class=\"event-title\">${event.title}</div>\n                  ${event.location ? `\n                    <div class=\"event-location\">\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                        <path d=\"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z\"></path>\n                        <circle cx=\"12\" cy=\"10\" r=\"3\"></circle>\n                      </svg>\n                      ${event.location}\n                    </div>\n                  ` : ''}\n                  ${event.duration ? `<div class=\"event-duration\">${event.duration}</div>` : ''}\n                </div>\n              </div>\n            </div>\n            `;\n          }).join('')}\n        </div>\n      </div>\n    `;\n  };\n  \n  // Helper function for free time format\n  const generateFreeTimeHTML = (responseText) => {\n    return `\n      <div class=\"styled-event-list\">\n        <div class=\"event-item\">\n          <div class=\"event-item-icon\" style=\"background-color: #ebf7ee; color: #34d399;\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n              <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"></path>\n              <polyline points=\"22 4 12 14.01 9 11.01\"></polyline>\n            </svg>\n          </div>\n          <div class=\"event-content\">\n            <p>${responseText}</p>\n          </div>\n        </div>\n      </div>\n    `;\n  };\n  \n  // Helper function for confirmation format\n  const generateConfirmationHTML = (responseText) => {\n    return `\n      <div class=\"styled-event-list\">\n        <div class=\"event-item\">\n          <div class=\"event-item-icon\" style=\"background-color: #e5edff; color: #3b82f6;\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n              <polyline points=\"20 6 9 17 4 12\"></polyline>\n            </svg>\n          </div>\n          <div class=\"event-content\">\n            <p>${responseText}</p>\n          </div>\n        </div>\n      </div>\n    `;\n  };\n  \n  // Helper function for default format\n  const defaultStyledFormat = (responseText) => {\n    return `\n      <div class=\"styled-event-list\">\n        <div class=\"event-item\">\n          <div class=\"event-item-icon\" style=\"background-color: #f5f3ff; color: #8b5cf6;\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n              <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n              <line x1=\"12\" y1=\"16\" x2=\"12\" y2=\"12\"></line>\n              <line x1=\"12\" y1=\"8\" x2=\"12.01\" y2=\"8\"></line>\n            </svg>\n          </div>\n          <div class=\"event-content\">\n            <p>${responseText}</p>\n          </div>\n        </div>\n      </div>\n    `;\n  };\n\n  // Render message content based on type\n  const renderMessage = (message, index) => {\n    if (message.type === 'welcome') {\n      return <WelcomeMessage key={index} />;\n    }\n    \n    if (message.type === 'error') {\n      return (\n        <ChatMessage \n          key={index} \n          sender={message.sender} \n          content={`<div class=\"error-content\">${message.content}</div>`} \n        />\n      );\n    }\n    \n    if (message.type === 'success') {\n      return (\n        <ChatMessage \n          key={index} \n          sender={message.sender} \n          content={`<div class=\"success-content\">${message.content}</div>`} \n        />\n      );\n    }\n    \n    // Format event lists in responses\n    const formattedContent = message.sender === 'bot' \n      ? formatStyledEventList(message.content) \n      : message.content;\n    \n    return (\n      <ChatMessage \n        key={index} \n        sender={message.sender} \n        content={formattedContent} \n      />\n    );\n  };\n\n  return (\n    <div className=\"w-full h-full\">\n      <ChatContainer>\n        <div className=\"relative\">\n          <ChatHeader />\n          <SettingsButton \n            onClick={() => setShowSettings(!showSettings)} \n            isOpen={showSettings} \n          />\n        </div>\n        \n        <div className={`settings-transition ${showSettings ? 'settings-open' : 'settings-closed'}`}>\n          {showSettings && (\n            <CalendarSettings \n              calendars={calendars}\n              selected={selectedCalendars}\n              onSelect={handleCalendarSelect}\n              disabled={loading}\n            />\n          )}\n        </div>\n        \n        <ChatMessages>\n          {chatMessages.map((msg, idx) => renderMessage(msg, idx))}\n          {showCalendar && renderCalendarMessage()}\n        </ChatMessages>\n        \n        {showRecommendations && suggestions.length > 0 && (\n          <RecommendationBar \n            suggestions={suggestions} \n            onSelectSuggestion={handleSelectSuggestion} \n          />\n        )}\n        \n        <ChatInput\n          value={text}\n          onChange={(e) => setText(e.target.value)}\n          onSubmit={handleSubmit}\n          loading={loading}\n        />\n      </ChatContainer>\n    </div>\n  );\n}\n\nfunction App() {\n  return (\n    <div className=\"App w-full\">\n      <h1 className=\"app-title\">Calendar Companion</h1>\n      <div className=\"app-container\">\n        <Suspense fallback={<div className=\"text-center p-10 text-white\">Loading application...</div>}>\n          <NaturalLanguageForm />\n        </Suspense>\n      </div>\n      \n      <script dangerouslySetInnerHTML={{\n        __html: `\n          // Directly define functions in the global scope\n          window.scheduleBreak = function(startTime, endTime) {\n            console.log(\"DOM scheduleBreak called with:\", startTime, endTime);\n            if (window.dispatchEvent) {\n              window.dispatchEvent(\n                new CustomEvent('scheduleCalendarItem', {\n                  detail: {\n                    type: 'break',\n                    startTime,\n                    endTime\n                  }\n                })\n              );\n            }\n          };\n          \n          window.scheduleTask = function(startTime, endTime) {\n            console.log(\"DOM scheduleTask called with:\", startTime, endTime);\n            if (window.dispatchEvent) {\n              window.dispatchEvent(\n                new CustomEvent('scheduleCalendarItem', {\n                  detail: {\n                    type: 'task',\n                    startTime,\n                    endTime\n                  }\n                })\n              );\n            }\n          };\n          \n          // Duration selector functions\n          window.showDurationSelector = function(startTime, endTime, selectorId, displayId, sliderId) {\n            console.log(\"Showing duration selector\", selectorId);\n            const durationSelector = document.getElementById(selectorId);\n            if (durationSelector) {\n              durationSelector.style.display = 'block';\n            } else {\n              console.error(\"Duration selector element not found:\", selectorId);\n            }\n          };\n          \n          window.updateDurationDisplay = function(minutes, displayId) {\n            console.log(\"Updating duration display to\", minutes, \"for\", displayId);\n            const durationDisplay = document.getElementById(displayId);\n            if (!durationDisplay) {\n              console.error(\"Duration display element not found:\", displayId);\n              return;\n            }\n            \n            let display = \"\";\n            if (minutes >= 60) {\n              const hours = Math.floor(minutes / 60);\n              const remainingMinutes = minutes % 60;\n              display = hours + \" hour\" + (hours > 1 ? \"s\" : \"\");\n              if (remainingMinutes > 0) {\n                display += \" \" + remainingMinutes + \" min\";\n              }\n            } else {\n              display = minutes + \" min\";\n            }\n            durationDisplay.textContent = display;\n          };\n          \n          window.scheduleBreakWithDuration = function(startTime, endTime, sliderId) {\n            console.log(\"Scheduling break with duration using slider\", sliderId);\n            const durationSlider = document.getElementById(sliderId);\n            if (!durationSlider) {\n              console.error(\"Duration slider not found:\", sliderId);\n              return;\n            }\n            \n            const durationMinutes = durationSlider.value;\n            console.log(\"Duration selected:\", durationMinutes);\n            \n            const startDateTime = new Date();\n            const [startHours, startMinutes] = startTime.split(':').map(Number);\n            startDateTime.setHours(startHours, startMinutes, 0);\n            \n            // Calculate end time based on selected duration\n            const endDateTime = new Date(startDateTime);\n            endDateTime.setMinutes(startDateTime.getMinutes() + parseInt(durationMinutes));\n            \n            const formattedEndTime = endDateTime.getHours().toString().padStart(2, '0') + ':' + \n                                  endDateTime.getMinutes().toString().padStart(2, '0');\n            \n            console.log(\"Calculated end time:\", formattedEndTime);\n            \n            // Call the existing scheduleBreak function\n            window.scheduleBreak(startTime, formattedEndTime);\n          };\n          \n          window.cancelDurationSelection = function(selectorId) {\n            console.log(\"Canceling duration selection for\", selectorId);\n            const durationSelector = document.getElementById(selectorId);\n            if (durationSelector) {\n              durationSelector.style.display = 'none';\n            } else {\n              console.error(\"Duration selector element not found:\", selectorId);\n            }\n          };\n          \n          console.log(\"Inline scheduling functions defined and attached to window object\");\n        `\n      }} />\n    </div>\n  );\n}\n\nexport default App;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}